<%
    # Top-level - Reset and set bread crumb to current page
    urlhistory = Breadcrumb.new
    urlhistory.setCurrentPage("Home","Home","/")
    urlhistory.setCurrentPage("Published Projects","Published Projects","/projects/published")
    session[:urlhistory] = urlhistory
%>
<div id='left-navigation-div' tabindex=100>
    <%= render :partial => "sidebars/mySRDR_sidebar" %>
</div>
<div id='content' tabindex=200>
<h1>Completed Systematic Reviews</h1><br/>
<br/>
<% unless @projects.empty? %>
	<%# render :partial=>'projects/published_list' %>
    <table class='list_table' >
        <tr>
          <th class='header_bar'><br/>
            <!-- ITEMS PER PAGE -->
            <% selected = session[:items_per_page].nil? ? 5 : session[:items_per_page] %>
            <% opts = [5,10,15,20,30,40,50] %>
            <label for="items_per_page_selector">Items Per Page:</label> 
            <select id='items_per_page_selector'>
                <% opts.each do |option| %>
                    <% sel = selected.to_i == option.to_i ? "selected" : "" %>
                    <option value=<%= option %> <%= sel %>><%= option %></option> 
                <% end %>
            </select>
          </th>
        </tr>
        <tr>
          <td class='pagination' style='text-align:center;'>
            <% if !@projects.empty? %>
                <%= will_paginate @projects %>
            <% end %>
          </td>
        </tr>
        <% @projects.each do |project| %>
          <% 
            num_studies = Project.get_num_studies(project)
            num_key_qs = Project.get_num_key_qs(project)
            num_ext_forms = Project.get_num_ext_forms(project)
          %>
          <tr>
            <td class='data' style='position:relative;line-height:20px;'>
                <span style='float:left;'>
                   <h2><%= project.title %></h2><br/>
                </span>
                <span style='float:right;position:relative; right:30px; top:0px;' class='status'>
                    Public Project
                    <span class="complete">Complete</span><br/>
                </span>
                <br clear='all'>
                <span class='bold'>Statistics:</span> <%= pluralize(num_studies, 'Study') %>,
                <%= pluralize(num_key_qs, 'Key Question') %>,
                <%= pluralize(num_ext_forms, 'Extraction Form') %>,    
                <%# Project.get_status_string(project.id) %><br/>
                <span class='bold'>Date Published: </span><%= project.updated_at.strftime("%b %d, %Y %I:%M%p") %><br/>

                <div class='comment more'>
                    <span class='bold'>Description: </span>
                    <%= project.description.blank? ? "None Provided" : project.description.force_encoding("UTF-8") %>
                </div>

                <div class='comment more'>
                    <span class='bold'>Contributor(s): </span>
                    <%= project.contributors.blank? ? "None Provided" : project.contributors.force_encoding("UTF-8") %><br>
                </div>

                <div class='comment more'>
                    <span class='bold'>Funding Source: </span>
                    <%= project.funding_source.blank? ? "None Provided" : project.funding_source.force_encoding("UTF-8") %><br>
                </div>

                <div class="comment more">
                    <span class='bold'>Methodology Description: </span>
                    <%= project.methodology.blank? ? "None Provided" : project.methodology.force_encoding("UTF-8") %>
                </div><br>
            </td>
            </tr>
        <% end %>
        <tr>
          <td class='pagination'>
            <% if !@projects.empty? %>
                <%= will_paginate @projects %>
            <% end %>
          </td>
        </tr>
    </table>
    <br/><br/>
<% else %>
	There are currently no publicly available projects in the system. 
<% end %>

</div>
<script type='text/javascript'>
<!--
$("#items_per_page_selector, #sort_by_selector").die();
$("#items_per_page_selector, #sort_by_selector").live("change",function(){
    var per_page = $("#items_per_page_selector").val();
    var sort_by = $("#sort_by_selector").val();
    var url = "/projects/published?";
    url = url + "page=1&items_per_page=" + per_page.toString();
    window.location.replace(url);
});
-->
</script>