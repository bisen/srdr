<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: ExtractionFormsController
  
    &mdash; Documentation by YARD 0.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (E)</a> &raquo; 
    
    
    <span class="title">ExtractionFormsController</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: ExtractionFormsController
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">ExtractionFormsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/controllers/extraction_forms_controller.rb</dd>
  
</dl>
<div class="clear"></div>



  
  
  
  
  


  
  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#adverse-instance_method" title="#adverse (instance method)">- (Object) <strong>adverse</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
adverse events table header builder for extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#arms-instance_method" title="#arms (instance method)">- (Object) <strong>arms</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
show extraction form arms tab.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ask_to_import_from_previous_forms-instance_method" title="#ask_to_import_from_previous_forms (instance method)">- (Object) <strong>ask_to_import_from_previous_forms</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
when creating a new extraction form and previous forms have already been
saved for a  given project, give the user the chance to import information
from those previous forms.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assign_key_questions-instance_method" title="#assign_key_questions (instance method)">- (Object) <strong>assign_key_questions</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
the function to assign key questions to an extraction form remove any
previously saved records for this extraction form and save the new entries.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#baselines-instance_method" title="#baselines (instance method)">- (Object) <strong>baselines</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
baseline characteristics question builder for extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clearSessionTemplateInfo-instance_method" title="#clearSessionTemplateInfo (instance method)">- (Object) <strong>clearSessionTemplateInfo</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">- (Object) <strong>create</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
save extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#design-instance_method" title="#design (instance method)">- (Object) <strong>design</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
design details question builder for extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">- (Object) <strong>destroy</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
delete extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit-instance_method" title="#edit (instance method)">- (Object) <strong>edit</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
display the editing mainpage for extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extraction_form_section_save-instance_method" title="#extraction_form_section_save (instance method)">- (Object) <strong>extraction_form_section_save</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
save whether a section is included in an extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#finalize-instance_method" title="#finalize (instance method)">- (Object) <strong>finalize</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
finalize the extraction form currently does not do anything.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">- (Object) <strong>index</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
display all extraction forms.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index_pdf-instance_method" title="#index_pdf (instance method)">- (Object) <strong>index_pdf</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
show print layout for printing an extraction form summary or saving as PDF.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#makeTemplateActive-instance_method" title="#makeTemplateActive (instance method)">- (Object) <strong>makeTemplateActive</strong>(myTemplate) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-instance_method" title="#new (instance method)">- (Object) <strong>new</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
create new form/enter title for extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#outcomes-instance_method" title="#outcomes (instance method)">- (Object) <strong>outcomes</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
default outcome name input for extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#preview-instance_method" title="#preview (instance method)">- (Object) <strong>preview</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
show the extraction form preview window.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#publications-instance_method" title="#publications (instance method)">- (Object) <strong>publications</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
show extraction form publications tab.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#quality-instance_method" title="#quality (instance method)">- (Object) <strong>quality</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
quality table header builder for extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#questions-instance_method" title="#questions (instance method)">- (Object) <strong>questions</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
key questions example section.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">- (Object) <strong>show</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
display extraction form summary.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">- (Object) <strong>update</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
update extraction form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_adverse_event_settings-instance_method" title="#update_adverse_event_settings (instance method)">- (Object) <strong>update_adverse_event_settings</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
updates whether to display table columns for arms and total values in the
adverse events table settings saved in the @extraction_form object.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#escape_quotes-instance_method" title="ApplicationController#escape_quotes (method)">#escape_quotes</a></span>, <span class='object_link'><a href="ApplicationController.html#set_as_current-instance_method" title="ApplicationController#set_as_current (method)">#set_as_current</a></span>, <span class='object_link'><a href="ApplicationController.html#show_other-instance_method" title="ApplicationController#show_other (method)">#show_other</a></span>, <span class='object_link'><a href="ApplicationController.html#show_other_filled-instance_method" title="ApplicationController#show_other_filled (method)">#show_other_filled</a></span>, <span class='object_link'><a href="ApplicationController.html#toggle_ahrq_header-instance_method" title="ApplicationController#toggle_ahrq_header (method)">#toggle_ahrq_header</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="adverse-instance_method">
  
    - (<tt>Object</tt>) <strong>adverse</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
adverse events table header builder for extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


136
137
138
139
140
141
142
143
144
145</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 136</span>

<span class='kw'>def</span> <span class='id identifier rubyid_adverse'>adverse</span>
		<span class='ivar'>@adverse_event_column</span> <span class='op'>=</span> <span class='const'>AdverseEventColumn</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_form_section</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:section_name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adverse</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>  
		<span class='ivar'>@extraction_form_adverse_event_columns</span> <span class='op'>=</span> <span class='const'>AdverseEventColumn</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>  
		<span class='ivar'>@model</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adverse_events</span><span class='tstring_end'>&quot;</span></span>
		<span class='ivar'>@donors</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_forms'>get_donor_forms</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adverse</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='ivar'>@donor_info</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_info'>get_donor_info</span><span class='lparen'>(</span><span class='ivar'>@donors</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AdverseEventColumn</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="arms-instance_method">
  
    - (<tt>Object</tt>) <strong>arms</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
show extraction form arms tab
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


87
88
89
90
91
92
93
94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 87</span>

<span class='kw'>def</span> <span class='id identifier rubyid_arms'>arms</span>
 	<span class='ivar'>@arms</span> <span class='op'>=</span> <span class='const'>ExtractionFormArm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
 	<span class='ivar'>@efid</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span>
 	<span class='ivar'>@extraction_form_arm</span> <span class='op'>=</span> <span class='const'>ExtractionFormArm</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@extraction_form_section</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:section_name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>arms</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
<span class='ivar'>@donors</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_forms'>get_donor_forms</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>arms</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='ivar'>@donor_info</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_info'>get_donor_info</span><span class='lparen'>(</span><span class='ivar'>@donors</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ExtractionFormArm</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ask_to_import_from_previous_forms-instance_method">
  
    - (<tt>Object</tt>) <strong>ask_to_import_from_previous_forms</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
when creating a new extraction form and previous forms have already been
saved for a  given project, give the user the chance to import information
from those previous forms.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


528
529
530</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 528</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ask_to_import_from_previous_forms'>ask_to_import_from_previous_forms</span>
	
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="assign_key_questions-instance_method">
  
    - (<tt>Object</tt>) <strong>assign_key_questions</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
the function to assign key questions to an extraction form remove any
previously saved records for this extraction form and save the new entries
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 50</span>

<span class='kw'>def</span> <span class='id identifier rubyid_assign_key_questions'>assign_key_questions</span>
	<span class='comment'># get the extraction form id
</span>	<span class='id identifier rubyid_ef_id'>ef_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_error'>error</span> <span class='op'>=</span> <span class='kw'>false</span>
			
	<span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
		<span class='comment'># remove the previous entries for this form
</span>		<span class='id identifier rubyid_entries'>entries</span> <span class='op'>=</span> <span class='const'>ExtractionFormKeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ef_id'>ef_id</span><span class='rparen'>)</span>
		<span class='kw'>unless</span> <span class='id identifier rubyid_entries'>entries</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='id identifier rubyid_entries'>entries</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
				<span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>
		
		<span class='comment'># add in the new entries for the form
</span>		<span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
			<span class='id identifier rubyid_kqid'>kqid</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
			<span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='const'>ExtractionFormKeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_ef_id'>ef_id</span><span class='comma'>,</span> <span class='symbol'>:key_question_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_kqid'>kqid</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_tmp'>tmp</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
		<span class='kw'>end</span>
		<span class='ivar'>@message_div</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>saved_item_indicator</span><span class='tstring_end'>'</span></span>
		<span class='ivar'>@saved</span> <span class='op'>=</span> <span class='kw'>true</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error_message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The operation was not allowed because each extraction form must be associated with at least one key question.</span><span class='tstring_end'>&quot;</span></span>
		<span class='ivar'>@error_partial</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>layouts/info_messages</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span>
<span class='ivar'>@error_div</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>validation_message</span><span class='tstring_end'>&quot;</span></span>		
	<span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>shared/saved.js.erb</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="baselines-instance_method">
  
    - (<tt>Object</tt>) <strong>baselines</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
baseline characteristics question builder for extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114
115
116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 110</span>

<span class='kw'>def</span> <span class='id identifier rubyid_baselines'>baselines</span> 	
<span class='ivar'>@extraction_form_section</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:section_name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baselines</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> 
<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@baseline_characteristic_field</span> <span class='op'>=</span> <span class='const'>BaselineCharacteristicField</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@model</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baseline_characteristic</span><span class='tstring_end'>&quot;</span></span>
<span class='ivar'>@questions</span> <span class='op'>=</span> <span class='const'>BaselineCharacteristic</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@baseline_characteristic</span> <span class='op'>=</span> <span class='const'>BaselineCharacteristic</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@donors</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_forms'>get_donor_forms</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baselines</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='ivar'>@donor_info</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_info'>get_donor_info</span><span class='lparen'>(</span><span class='ivar'>@donors</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BaselineCharacteristic</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="clearSessionTemplateInfo-instance_method">
  
    - (<tt>Object</tt>) <strong>clearSessionTemplateInfo</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong> 
    <div class='inline'><p>
describe this
</p>
</div>
  </div>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


437
438
439
440
441</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 437</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clearSessionTemplateInfo'>clearSessionTemplateInfo</span>
 	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
 	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
 	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="create-instance_method">
  
    - (<tt>Object</tt>) <strong>create</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
save extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 223</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
 <span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form</span><span class='rbracket'>]</span><span class='rparen'>)</span>
 <span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>	
 <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_creator_id'>creator_id</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
 <span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span> 
 <span class='id identifier rubyid_title_is_unique'>title_is_unique</span> <span class='op'>=</span> <span class='kw'>false</span>
 <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
 	<span class='id identifier rubyid_title_is_unique'>title_is_unique</span> <span class='op'>=</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_is_title_unique_for_user'>is_title_unique_for_user</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
 <span class='kw'>end</span>
 <span class='kw'>if</span> <span class='id identifier rubyid_title_is_unique'>title_is_unique</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@saved</span> <span class='op'>=</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
<span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
	<span class='id identifier rubyid_kqid'>kqid</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='const'>ExtractionFormKeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:key_question_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_kqid'>kqid</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_tmp'>tmp</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
<span class='kw'>end</span>
<span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_create_included_section_fields'>create_included_section_fields</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_create_default_questions'>create_default_questions</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:success</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Your extraction form was successfully initiated.</span><span class='tstring_end'>&quot;</span></span>
<span class='ivar'>@extraction_form_section</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@donors</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_forms'>get_donor_forms</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>arms</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='ivar'>@donor_info</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_info'>get_donor_info</span><span class='lparen'>(</span><span class='ivar'>@donors</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ExtractionFormArm</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='ivar'>@arms</span> <span class='op'>=</span> <span class='const'>ExtractionFormArm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='ivar'>@extraction_form_arm</span> <span class='op'>=</span> <span class='const'>ExtractionFormArm</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@previous_extraction_forms</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span><span class='symbol'>:conditions</span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>project_id=? AND id &lt;&gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@assigned_questions_hash</span><span class='comma'>,</span> <span class='ivar'>@included_sections_hash</span><span class='comma'>,</span><span class='ivar'>@checked_boxes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
		
<span class='comment'># for each of the previously existing forms
</span><span class='ivar'>@previous_extraction_forms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
	<span class='comment'># get the key questions assigned
</span>	<span class='ivar'>@assigned_questions_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_get_assigned_question_numbers'>get_assigned_question_numbers</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='comment'># get the sections included
</span>	<span class='ivar'>@included_sections_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections_by_extraction_form_id'>get_included_sections_by_extraction_form_id</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>	
	<span class='ivar'>@borrowers</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowers'>get_borrowers</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='comment'># determine which boxes should already be checked
</span>	<span class='id identifier rubyid_already_entered'>already_entered</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_previous_data'>get_previous_data</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_already_entered'>already_entered</span> <span class='op'>=</span> <span class='id identifier rubyid_already_entered'>already_entered</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_section_name'>section_name</span><span class='rbrace'>}</span>
	<span class='ivar'>@checked_boxes</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_already_entered'>already_entered</span>
	<span class='comment'># get rid of key questions and publications
</span>	<span class='ivar'>@included_sections_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
	<span class='ivar'>@included_sections_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
<span class='kw'>end</span>	
	<span class='kw'>else</span>
<span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_title_is_unique'>title_is_unique</span>
	<span class='id identifier rubyid_error_message'>error_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must choose a title that you have not previously used for an extraction form.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>elsif</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
	<span class='id identifier rubyid_error_message'>error_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must select at least one key question to associate with this extraction form.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>else</span>
	<span class='id identifier rubyid_error_message'>error_message</span> <span class='op'>=</span> <span class='id identifier rubyid_create_error_message_html'>create_error_message_html</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='rparen'>)</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_error_message'>error_message</span>
	<span class='kw'>end</span>
	<span class='ivar'>@key_questions_assigned</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='comment'># get the key questions associated with each form
</span>	<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>		
	<span class='kw'>unless</span> <span class='ivar'>@extraction_forms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='id identifier rubyid_efids'>efids</span> <span class='op'>=</span> <span class='ivar'>@extraction_forms</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span>
<span class='id identifier rubyid_efids'>efids</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
<span class='id identifier rubyid_efids'>efids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_eid'>eid</span><span class='op'>|</span>
	<span class='id identifier rubyid_kqs'>kqs</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_get_assigned_question_numbers'>get_assigned_question_numbers</span><span class='lparen'>(</span><span class='id identifier rubyid_eid'>eid</span><span class='rparen'>)</span>
	<span class='ivar'>@key_questions_assigned</span><span class='lbracket'>[</span><span class='id identifier rubyid_eid'>eid</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_kqs'>kqs</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>	
<span class='kw'>end</span>
	<span class='kw'>end</span>
	<span class='ivar'>@key_questions</span> <span class='op'>=</span> <span class='const'>KeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='id identifier rubyid_available_question_info'>available_question_info</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_get_available_questions'>get_available_questions</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='kw'>nil</span><span class='rparen'>)</span>
	<span class='ivar'>@available_questions</span> <span class='op'>=</span> <span class='id identifier rubyid_available_question_info'>available_question_info</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
	<span class='ivar'>@assigned_questions</span> <span class='op'>=</span> <span class='id identifier rubyid_available_question_info'>available_question_info</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>	
	<span class='ivar'>@no_more_extraction_forms</span> <span class='op'>=</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_all_key_questions_accounted_for'>all_key_questions_accounted_for</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="design-instance_method">
  
    - (<tt>Object</tt>) <strong>design</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
design details question builder for extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


99
100
101
102
103
104
105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 99</span>

<span class='kw'>def</span> <span class='id identifier rubyid_design'>design</span>
		<span class='ivar'>@extraction_form_section</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:section_name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>design</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> 
		<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@model</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>design_detail</span><span class='tstring_end'>&quot;</span></span>
		<span class='ivar'>@questions</span> <span class='op'>=</span> <span class='const'>DesignDetail</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>question_number ASC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='ivar'>@design_detail</span> <span class='op'>=</span> <span class='const'>DesignDetail</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@donors</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_forms'>get_donor_forms</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>design</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='ivar'>@donor_info</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_info'>get_donor_info</span><span class='lparen'>(</span><span class='ivar'>@donors</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DesignDetail</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="destroy-instance_method">
  
    - (<tt>Object</tt>) <strong>destroy</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
delete extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 367</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
  <span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
  <span class='comment'># determine if an extraction form can be deleted. It cannot be deleted if it 
</span>  <span class='comment'># has studies associated to it, either directly or indirectly (by being associated
</span>  <span class='comment'># with another extraction form borrowing information from it that has studies)
</span>  <span class='id identifier rubyid_ok_to_delete'>ok_to_delete</span> <span class='op'>=</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_can_be_removed?'>can_be_removed?</span>
  
  <span class='kw'>if</span> <span class='id identifier rubyid_ok_to_delete'>ok_to_delete</span>
	<span class='ivar'>@ef_outcome_columns</span> <span class='op'>=</span> <span class='const'>OutcomeColumn</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='kw'>for</span> <span class='id identifier rubyid_tc'>tc</span> <span class='kw'>in</span> <span class='ivar'>@ef_outcome_columns</span>
		<span class='id identifier rubyid_tc'>tc</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
	<span class='kw'>end</span>
					
	<span class='comment'># remove all entries in the extraction_form_sections table
</span>	<span class='id identifier rubyid_j'>j</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_j'>j</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
		<span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
	<span class='kw'>end</span>
	
	<span class='comment'># update the extraction_form_key_questions table
</span>	<span class='id identifier rubyid_ef_kqs'>ef_kqs</span> <span class='op'>=</span> <span class='const'>ExtractionFormKeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_ef_kqs'>ef_kqs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_efkq'>efkq</span><span class='op'>|</span>
		<span class='id identifier rubyid_efkq'>efkq</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
	<span class='kw'>end</span>
	
	<span class='comment'># remove any quality dimensions associated with the extraction form.
</span>	<span class='id identifier rubyid_ef_qd'>ef_qd</span> <span class='op'>=</span> <span class='const'>QualityDimensionField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_ef_qd'>ef_qd</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_qd'>qd</span><span class='op'>|</span>
		<span class='id identifier rubyid_qd'>qd</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
	<span class='kw'>end</span>
	
	<span class='comment'># remove any quality ratings associated with the extraction form
</span>	<span class='id identifier rubyid_ef_qr'>ef_qr</span> <span class='op'>=</span> <span class='const'>QualityRatingField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_ef_qr'>ef_qr</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_qr'>qr</span><span class='op'>|</span>
		<span class='id identifier rubyid_qr'>qr</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
	<span class='kw'>end</span>
	
	<span class='comment'># remove the link between this form and any that it is inheriting information from
</span>	<span class='id identifier rubyid_ef_donor'>ef_donor</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:copied_to</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_ef_donor'>ef_donor</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_donor'>donor</span><span class='op'>|</span>
		<span class='id identifier rubyid_donor'>donor</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
	<span class='kw'>end</span>
	
	<span class='comment'># remove all associated baseline characteristics
</span>	<span class='id identifier rubyid_baselines'>baselines</span> <span class='op'>=</span> <span class='const'>BaselineCharacteristic</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='kw'>unless</span> <span class='id identifier rubyid_baselines'>baselines</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='id identifier rubyid_baselines'>baselines</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_bl'>bl</span><span class='op'>|</span>
			<span class='id identifier rubyid_bl'>bl</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	
	<span class='comment'># remove all associated design details
</span>	<span class='id identifier rubyid_designs'>designs</span> <span class='op'>=</span> <span class='const'>DesignDetail</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='kw'>unless</span> <span class='id identifier rubyid_designs'>designs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='id identifier rubyid_designs'>designs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_des'>des</span><span class='op'>|</span>
			<span class='id identifier rubyid_des'>des</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	
   <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:success</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Extraction form deleted successfully.</span><span class='tstring_end'>&quot;</span></span>		
	<span class='kw'>else</span>
<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You cannot delete this extraction form until any associated studies have been removed and no other extraction forms are importing data from it.</span><span class='tstring_end'>&quot;</span></span>	
	<span class='kw'>end</span>

	<span class='id identifier rubyid_redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id identifier rubyid_project_path'>project_path</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/extraction_forms</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="edit-instance_method">
  
    - (<tt>Object</tt>) <strong>edit</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
display the editing mainpage for extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


212
213
214
215
216
217
218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 212</span>

<span class='kw'>def</span> <span class='id identifier rubyid_edit'>edit</span>
  <span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
	<span class='ivar'>@key_questions</span> <span class='op'>=</span> <span class='const'>KeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='id identifier rubyid_available_question_info'>available_question_info</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_get_available_questions'>get_available_questions</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='kw'>nil</span><span class='rparen'>)</span>
	<span class='ivar'>@available_questions</span> <span class='op'>=</span> <span class='id identifier rubyid_available_question_info'>available_question_info</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
	<span class='ivar'>@assigned_questions</span> <span class='op'>=</span> <span class='id identifier rubyid_available_question_info'>available_question_info</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>	
	<span class='ivar'>@no_more_extraction_forms</span> <span class='op'>=</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_all_key_questions_accounted_for'>all_key_questions_accounted_for</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="extraction_form_section_save-instance_method">
  
    - (<tt>Object</tt>) <strong>extraction_form_section_save</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
save whether a section is included in an extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 451</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extraction_form_section_save'>extraction_form_section_save</span>
	<span class='ivar'>@extraction_form_section</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:section_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@extraction_form_section</span><span class='period'>.</span><span class='id identifier rubyid_section_name'>section_name</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:section_name</span><span class='rbracket'>]</span>
	<span class='ivar'>@extraction_form_section</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:included</span><span class='rbracket'>]</span>

<span class='kw'>if</span> <span class='ivar'>@saved</span> <span class='op'>=</span> <span class='ivar'>@extraction_form_section</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
	<span class='kw'>if</span> <span class='ivar'>@extraction_form_section</span><span class='period'>.</span><span class='id identifier rubyid_section_name'>section_name</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outcomes</span><span class='tstring_end'>&quot;</span></span>
		<span class='comment'># if the outcomes section is included, we want to include the results and comparisons
</span>		<span class='id identifier rubyid_ef_id'>ef_id</span> <span class='op'>=</span> <span class='ivar'>@extraction_form_section</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span>
		<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_ef_id'>ef_id</span><span class='comma'>,</span> <span class='symbol'>:section_name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>results</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
		<span class='id identifier rubyid_comparisons'>comparisons</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_ef_id'>ef_id</span><span class='comma'>,</span> <span class='symbol'>:section_name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comparisons</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
		<span class='kw'>if</span> <span class='ivar'>@extraction_form_section</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span>
			<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='kw'>true</span>
			<span class='id identifier rubyid_comparisons'>comparisons</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='kw'>true</span>    			
		<span class='comment'>#if the outcomes section is not included, we want to shut off the results and comparisons
</span><span class='kw'>else</span>
			<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='kw'>false</span>
			<span class='id identifier rubyid_comparisons'>comparisons</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
	<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
	<span class='id identifier rubyid_comparisons'>comparisons</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
	<span class='kw'>end</span>
<span class='ivar'>@included</span> <span class='op'>=</span> <span class='ivar'>@extraction_form_section</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span>
	<span class='kw'>else</span>
<span class='ivar'>@error_div</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>validation_message</span><span class='tstring_end'>&quot;</span></span>
     	<span class='id identifier rubyid_problem_html'>problem_html</span> <span class='op'>=</span> <span class='id identifier rubyid_create_error_message_html'>create_error_message_html</span><span class='lparen'>(</span><span class='ivar'>@extraction_form_section</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='rparen'>)</span>
<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_problem_html'>problem_html</span>
<span class='ivar'>@error_partial</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>layouts/info_messages</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="finalize-instance_method">
  
    - (<tt>Object</tt>) <strong>finalize</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
finalize the extraction form currently does not do anything
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 294</span>

<span class='kw'>def</span> <span class='id identifier rubyid_finalize'>finalize</span>
	<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="index-instance_method">
  
    - (<tt>Object</tt>) <strong>index</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
display all extraction forms
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25
26
27
28
29
30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
	<span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:all</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
		<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='ivar'>@title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Listing All Extraction Forms</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_available'>available</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_get_available_extraction_form_ids'>get_available_extraction_form_ids</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_available'>available</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_paginate'>paginate</span><span class='lparen'>(</span><span class='symbol'>:page</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Your Extraction Forms</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="index_pdf-instance_method">
  
    - (<tt>Object</tt>) <strong>index_pdf</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
show print layout for printing an extraction form summary or saving as PDF
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17
18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 8</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index_pdf'>index_pdf</span>
	<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@ef_key_questions</span> <span class='op'>=</span> <span class='const'>ExtractionFormKeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@extraction_form_arms</span> <span class='op'>=</span> <span class='const'>ExtractionFormArm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='id identifier rubyid_proj_id'>proj_id</span> <span class='op'>=</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_proj_id'>proj_id</span><span class='rparen'>)</span>
	<span class='ivar'>@sections_list</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_section_name'>section_name</span><span class='rbrace'>}</span>
	<span class='ivar'>@quality_dimension_extraction_form_fields</span> <span class='op'>=</span> <span class='const'>QualityDimensionField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>	
	<span class='ivar'>@extraction_form_adverse_event_columns</span> <span class='op'>=</span> <span class='const'>AdverseEventColumn</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@saved_names</span> <span class='op'>=</span> <span class='const'>ExtractionFormOutcomeName</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='ivar'>@quality_rating_fields</span> <span class='op'>=</span> <span class='const'>QualityRatingField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span> 
	<span class='id identifier rubyid_render'>render</span> <span class='symbol'>:pdf</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbol'>:template</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>extraction_forms/show_print.html.erb</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:layout</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>print</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:disable_javascript</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:header</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:center</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SRDR Extraction Form</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="makeTemplateActive-instance_method">
  
    - (<tt>Object</tt>) <strong>makeTemplateActive</strong>(myTemplate) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong> 
    <div class='inline'><p>
describe this
</p>
</div>
  </div>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


444
445
446
447
448</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 444</span>

<span class='kw'>def</span> <span class='id identifier rubyid_makeTemplateActive'>makeTemplateActive</span> <span class='id identifier rubyid_myTemplate'>myTemplate</span>
	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_myTemplate'>myTemplate</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
 	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="new-instance_method">
  
    - (<tt>Object</tt>) <strong>new</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
create new form/enter title for extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


197
198
199
200
201
202
203
204
205
206
207
208
209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 197</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>	
	<span class='comment'># get information about the key questions in the project
</span>	<span class='ivar'>@key_questions</span> <span class='op'>=</span> <span class='const'>KeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span><span class='op'>=&gt;</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='id identifier rubyid_available_question_info'>available_question_info</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_get_available_questions'>get_available_questions</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='kw'>nil</span><span class='rparen'>)</span>
	<span class='ivar'>@available_questions</span> <span class='op'>=</span> <span class='id identifier rubyid_available_question_info'>available_question_info</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
	<span class='ivar'>@assigned_questions</span> <span class='op'>=</span> <span class='id identifier rubyid_available_question_info'>available_question_info</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>	
	<span class='ivar'>@no_more_extraction_forms</span> <span class='op'>=</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_all_key_questions_accounted_for'>all_key_questions_accounted_for</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:errors</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  	<span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:errors</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="outcomes-instance_method">
  
    - (<tt>Object</tt>) <strong>outcomes</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
default outcome name input for extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


122
123
124
125
126
127
128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 122</span>

<span class='kw'>def</span> <span class='id identifier rubyid_outcomes'>outcomes</span>
		<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_form_section</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:section_name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outcomes</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> 
		<span class='ivar'>@extraction_form_outcome_name</span> <span class='op'>=</span> <span class='const'>ExtractionFormOutcomeName</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@model</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outcomes</span><span class='tstring_end'>&quot;</span></span>
		<span class='ivar'>@donors</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_forms'>get_donor_forms</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outcomes</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>if</span> <span class='ivar'>@donors</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='ivar'>@saved_names</span> <span class='op'>=</span>  <span class='const'>ExtractionFormOutcomeName</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='semicolon'>;</span>
		<span class='kw'>else</span>
<span class='ivar'>@donor_info</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_info'>get_donor_info</span><span class='lparen'>(</span><span class='ivar'>@donors</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ExtractionFormOutcomeName</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="preview-instance_method">
  
    - (<tt>Object</tt>) <strong>preview</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
show the extraction form preview window. The preview window will pop up via
an ajax call on the project summary pages.  this function gets all the
necessary data to show in the preview window.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184
185
186
187
188
189
190
191
192
193
194</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 182</span>

<span class='kw'>def</span> <span class='id identifier rubyid_preview'>preview</span>
	<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span> 
	<span class='ivar'>@ef_key_questions</span> <span class='op'>=</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_get_assigned_kq_objects'>get_assigned_kq_objects</span>
	<span class='ivar'>@extraction_form_arms</span> <span class='op'>=</span> <span class='const'>ExtractionFormArm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
	<span class='ivar'>@quality_dimension_extraction_form_fields</span> <span class='op'>=</span> <span class='const'>QualityDimensionField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@extraction_form_categorical_columns</span> <span class='op'>=</span> <span class='const'>OutcomeColumn</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:outcome_type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Categorical</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@extraction_form_continuous_columns</span> <span class='op'>=</span> <span class='const'>OutcomeColumn</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:outcome_type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Continuous</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>		
	<span class='ivar'>@extraction_form_adverse_event_columns</span> <span class='op'>=</span> <span class='const'>AdverseEventColumn</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@saved_names</span> <span class='op'>=</span> <span class='const'>ExtractionFormOutcomeName</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='ivar'>@quality_rating_fields</span> <span class='op'>=</span> <span class='const'>QualityRatingField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>	
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="publications-instance_method">
  
    - (<tt>Object</tt>) <strong>publications</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
show extraction form publications tab
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 81</span>

<span class='kw'>def</span> <span class='id identifier rubyid_publications'>publications</span>
		<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_form_section</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:section_name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>publications</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="quality-instance_method">
  
    - (<tt>Object</tt>) <strong>quality</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
quality table header builder for extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 148</span>

<span class='kw'>def</span> <span class='id identifier rubyid_quality'>quality</span>
<span class='ivar'>@model</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>quality_dimensions</span><span class='tstring_end'>&quot;</span></span>
<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
<span class='ivar'>@extraction_form_section</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:section_name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>quality</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> 
<span class='ivar'>@donors</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_forms'>get_donor_forms</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>quality</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>if</span> <span class='ivar'>@donors</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	<span class='ivar'>@quality_dimension_field</span> <span class='op'>=</span> <span class='const'>QualityDimensionField</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@quality_dimension_fields</span> <span class='op'>=</span> <span class='const'>QualityDimensionField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@quality_rating_field</span> <span class='op'>=</span> <span class='const'>QualityRatingField</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@quality_rating_fields</span> <span class='op'>=</span><span class='const'>QualityRatingField</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='symbol'>:order</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>display_number ASC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>else</span>
	<span class='ivar'>@donor_ratings</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_info'>get_donor_info</span><span class='lparen'>(</span><span class='ivar'>@donors</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>QualityRatingField</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='ivar'>@donor_dimensions</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_info'>get_donor_info</span><span class='lparen'>(</span><span class='ivar'>@donors</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>QualityDimensionField</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="questions-instance_method">
  
    - (<tt>Object</tt>) <strong>questions</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
key questions example section
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37
38
39
40
41
42
43
44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 35</span>

<span class='kw'>def</span> <span class='id identifier rubyid_questions'>questions</span>
	<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@assigned_questions</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_get_assigned_key_questions'>get_assigned_key_questions</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@key_questions</span> <span class='op'>=</span> <span class='const'>KeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	
	<span class='comment'># get information regarding which questions are still available, and which have been assigned 
</span>	<span class='comment'># to other extraction forms
</span>	<span class='id identifier rubyid_available_question_info'>available_question_info</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_get_available_questions'>get_available_questions</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	
	<span class='ivar'>@available_questions</span> <span class='op'>=</span> <span class='id identifier rubyid_available_question_info'>available_question_info</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
	<span class='ivar'>@assigned_to_other</span> <span class='op'>=</span> <span class='id identifier rubyid_available_question_info'>available_question_info</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="show-instance_method">
  
    - (<tt>Object</tt>) <strong>show</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
display extraction form summary
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


166
167
168
169
170
171
172
173
174
175
176
177
178</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 166</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
	<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@ef_key_questions</span> <span class='op'>=</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_get_assigned_kq_objects'>get_assigned_kq_objects</span>
	<span class='ivar'>@extraction_form_arms</span> <span class='op'>=</span> <span class='const'>ExtractionFormArm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@arms</span> <span class='op'>=</span> <span class='const'>ExtractionFormArm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='id identifier rubyid_proj_id'>proj_id</span> <span class='op'>=</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_proj_id'>proj_id</span><span class='rparen'>)</span>
	<span class='ivar'>@sections_list</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_section_name'>section_name</span><span class='rbrace'>}</span>
	<span class='ivar'>@quality_dimension_extraction_form_fields</span> <span class='op'>=</span> <span class='const'>QualityDimensionField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>	
	<span class='ivar'>@extraction_form_adverse_event_columns</span> <span class='op'>=</span> <span class='const'>AdverseEventColumn</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='ivar'>@saved_names</span> <span class='op'>=</span> <span class='const'>ExtractionFormOutcomeName</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='ivar'>@quality_rating_fields</span> <span class='op'>=</span> <span class='const'>QualityRatingField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update-instance_method">
  
    - (<tt>Object</tt>) <strong>update</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
update extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 299</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
  <span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
<span class='id identifier rubyid_original_title'>original_title</span> <span class='op'>=</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span>
  <span class='id identifier rubyid_title_is_unique'>title_is_unique</span> <span class='op'>=</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_is_title_unique_for_user'>is_title_unique_for_user</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_title_is_unique'>title_is_unique</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span>
<span class='ivar'>@saved</span> <span class='op'>=</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
<span class='comment'>#destroy old key question entries
</span><span class='ivar'>@key_questions</span> <span class='op'>=</span> <span class='const'>ExtractionFormKeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='ivar'>@key_questions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_kq'>kq</span><span class='op'>|</span>
	<span class='id identifier rubyid_kq'>kq</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
<span class='kw'>end</span>
<span class='comment'>#add selected key questions
</span><span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
	<span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
		<span class='id identifier rubyid_kqid'>kqid</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='const'>ExtractionFormKeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:key_question_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_kqid'>kqid</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_tmp'>tmp</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
	<span class='kw'>end</span>
<span class='kw'>end</span>
<span class='comment'>#get list of extraction forms and questions assigned to them
</span><span class='ivar'>@key_questions_assigned</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>			
<span class='kw'>unless</span> <span class='ivar'>@extraction_forms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	<span class='id identifier rubyid_efids'>efids</span> <span class='op'>=</span> <span class='ivar'>@extraction_forms</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span>
	<span class='id identifier rubyid_efids'>efids</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
	<span class='id identifier rubyid_efids'>efids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_eid'>eid</span><span class='op'>|</span>
		<span class='id identifier rubyid_kqs'>kqs</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_get_assigned_question_numbers'>get_assigned_question_numbers</span><span class='lparen'>(</span><span class='id identifier rubyid_eid'>eid</span><span class='rparen'>)</span>
		<span class='ivar'>@key_questions_assigned</span><span class='lbracket'>[</span><span class='id identifier rubyid_eid'>eid</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_kqs'>kqs</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>	
	<span class='kw'>end</span>
<span class='kw'>end</span>
<span class='ivar'>@extraction_form_section</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@donors</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_forms'>get_donor_forms</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>arms</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='ivar'>@donor_info</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_donor_info'>get_donor_info</span><span class='lparen'>(</span><span class='ivar'>@donors</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ExtractionFormArm</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
 	<span class='ivar'>@arms</span> <span class='op'>=</span> <span class='const'>ExtractionFormArm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
 	<span class='ivar'>@extraction_form_arm</span> <span class='op'>=</span> <span class='const'>ExtractionFormArm</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@previous_extraction_forms</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span><span class='symbol'>:conditions</span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>project_id == ? AND id &lt;&gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@assigned_questions_hash</span><span class='comma'>,</span> <span class='ivar'>@included_sections_hash</span><span class='comma'>,</span><span class='ivar'>@checked_boxes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
<span class='comment'># for each of the previously existing forms
</span><span class='ivar'>@previous_extraction_forms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
	<span class='comment'># get the key questions assigned
</span>	<span class='ivar'>@assigned_questions_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_get_assigned_question_numbers'>get_assigned_question_numbers</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='comment'># get the sections included
</span>	<span class='ivar'>@included_sections_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections_by_extraction_form_id'>get_included_sections_by_extraction_form_id</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>	
	<span class='ivar'>@borrowers</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowers'>get_borrowers</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='comment'># determine which boxes should already be checked
</span>	<span class='id identifier rubyid_already_entered'>already_entered</span> <span class='op'>=</span> <span class='const'>ExtractionFormSectionCopy</span><span class='period'>.</span><span class='id identifier rubyid_get_previous_data'>get_previous_data</span><span class='lparen'>(</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_already_entered'>already_entered</span> <span class='op'>=</span> <span class='id identifier rubyid_already_entered'>already_entered</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_section_name'>section_name</span><span class='rbrace'>}</span>
	<span class='ivar'>@checked_boxes</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_already_entered'>already_entered</span>
	<span class='ivar'>@included_sections_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='semicolon'>;</span><span class='ivar'>@included_sections_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='semicolon'>;</span>
<span class='kw'>end</span>
	<span class='kw'>else</span>
	<span class='comment'>#show page again
</span>   <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_title_is_unique'>title_is_unique</span>
	<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You have already defined an extraction form titled </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rbrace'>}</span><span class='tstring_content'>. Please choose a new title and try again.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>elsif</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_key_questions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
	<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please assign at least one key question to your extraction form.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
  <span class='kw'>end</span>
	<span class='ivar'>@key_questions</span> <span class='op'>=</span> <span class='const'>KeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='id identifier rubyid_available_question_info'>available_question_info</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_get_available_questions'>get_available_questions</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='kw'>nil</span><span class='rparen'>)</span>
	<span class='ivar'>@available_questions</span> <span class='op'>=</span> <span class='id identifier rubyid_available_question_info'>available_question_info</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
	<span class='ivar'>@assigned_questions</span> <span class='op'>=</span> <span class='id identifier rubyid_available_question_info'>available_question_info</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>	
	<span class='ivar'>@no_more_extraction_forms</span> <span class='op'>=</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_all_key_questions_accounted_for'>all_key_questions_accounted_for</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update_adverse_event_settings-instance_method">
  
    - (<tt>Object</tt>) <strong>update_adverse_event_settings</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
updates whether to display table columns for arms and total values in the
adverse events table settings saved in the @extraction_form object
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/extraction_forms_controller.rb', line 485</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_adverse_event_settings'>update_adverse_event_settings</span>
	<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	
	<span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:arm_or_total_selector</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>arm_and_total</span><span class='tstring_end'>&quot;</span></span>
<span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_adverse_event_display_arms'>adverse_event_display_arms</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_adverse_event_display_total'>adverse_event_display_total</span> <span class='op'>=</span> <span class='kw'>true</span>		
	<span class='kw'>elsif</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:arm_or_total_selector</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>arm</span><span class='tstring_end'>&quot;</span></span>
<span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_adverse_event_display_arms'>adverse_event_display_arms</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_adverse_event_display_total'>adverse_event_display_total</span> <span class='op'>=</span> <span class='kw'>false</span>			
	<span class='kw'>else</span>
<span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_adverse_event_display_arms'>adverse_event_display_arms</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_adverse_event_display_total'>adverse_event_display_total</span> <span class='op'>=</span> <span class='kw'>true</span>			
	<span class='kw'>end</span>
	
	<span class='ivar'>@study_efs</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@study_efs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_study_ef'>study_ef</span><span class='op'>|</span>
<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_study_ef'>study_ef</span><span class='period'>.</span><span class='id identifier rubyid_study_id'>study_id</span><span class='rparen'>)</span>
<span class='ivar'>@adverse_events_old</span> <span class='op'>=</span> <span class='const'>AdverseEvent</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='ivar'>@adverse_events_old</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_advev'>advev</span><span class='op'>|</span>
	<span class='id identifier rubyid_advev'>advev</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
	<span class='ivar'>@advev_results</span> <span class='op'>=</span> <span class='const'>AdverseEventResult</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:adverse_event_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_advev'>advev</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@advev_results</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ae_result'>ae_result</span><span class='op'>|</span>
		<span class='id identifier rubyid_ae_result'>ae_result</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
	<span class='kw'>end</span>
<span class='kw'>end</span>
	<span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
<span class='ivar'>@message_div</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>saved_item_indicator_advsettings</span><span class='tstring_end'>'</span></span>
<span class='ivar'>@extraction_form_adverse_event_columns</span> <span class='op'>=</span> <span class='const'>AdverseEventColumn</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='ivar'>@table_container</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adverse_event_fields_table</span><span class='tstring_end'>&quot;</span></span>
<span class='ivar'>@table_partial</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adverse_event_columns/table</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
<span class='ivar'>@error_div</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>validation_message_advsettings</span><span class='tstring_end'>&quot;</span></span>
     	<span class='id identifier rubyid_problem_html'>problem_html</span> <span class='op'>=</span> <span class='id identifier rubyid_create_error_message_html'>create_error_message_html</span><span class='lparen'>(</span><span class='ivar'>@extraction_form_section</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='rparen'>)</span>
<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_problem_html'>problem_html</span>
<span class='ivar'>@error_partial</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>layouts/info_messages</span><span class='tstring_end'>&quot;</span></span>	
  <span class='kw'>end</span>
	<span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>shared/saved.js.erb</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Wed Feb  1 16:26:53 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.4 (ruby-1.9.2).
</div>

  </body>
</html>