<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: StudiesController
  
    &mdash; Documentation by YARD 0.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (S)</a> &raquo; 
    
    
    <span class="title">StudiesController</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: StudiesController
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">StudiesController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/controllers/studies_controller.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This controller handles all pages for study data extraction, as well as
basic creation, updating and deletion of studies.
</p>


  </div>
</div>
<div class="tags">
  

</div>

  
  
  
  
  


  
  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#adverse-instance_method" title="#adverse (instance method)">- (Object) <strong>adverse</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays study adverse event page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#arms-instance_method" title="#arms (instance method)">- (Object) <strong>arms</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays study interventions page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#baselines-instance_method" title="#baselines (instance method)">- (Object) <strong>baselines</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays study baseline characteristics page contains the question builder
and template sections for baseline characteristics.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clearSessionStudyInfo-instance_method" title="#clearSessionStudyInfo (instance method)">- (Object) <strong>clearSessionStudyInfo</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
set the session data to nil possibly deprecated?.
</p>
</div></span>
  
</li>

      
        <li class="public deprecated">
  <span class="summary_signature">
    
      <a href="#comparisons-instance_method" title="#comparisons (instance method)">- (Object) <strong>comparisons</strong> </a>
    

    
  </span>
  
  
  
  
  <span class="deprecated note title">Deprecated</span>
  

  
    <span class="summary_desc"><strong>Deprecated.</strong> <div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">- (Object) <strong>create</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
create a new study.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_for_pmid_list-instance_method" title="#create_for_pmid_list (instance method)">- (Object) <strong>create_for_pmid_list</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Given a list of pubmed identifiers from the user,  create a corresponding
study for each.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#design-instance_method" title="#design (instance method)">- (Object) <strong>design</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays study design details page contains the question builder and
template sections for design details.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">- (Object) <strong>destroy</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
destroy a study.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit-instance_method" title="#edit (instance method)">- (Object) <strong>edit</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays study editing page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extractionforms-instance_method" title="#extractionforms (instance method)">- (Object) <strong>extractionforms</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays study extraction form page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_questions_params-instance_method" title="#get_questions_params (instance method)">- (array) <strong>get_questions_params</strong>(form_params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
get an array based on form parameters being submitted.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">- (Object) <strong>index</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
shows list of studies for the project with id = params[:project_id].
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index_pdf-instance_method" title="#index_pdf (instance method)">- (Object) <strong>index_pdf</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
show the print layout in order to export a study summary to pdf.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#makeStudyActive-instance_method" title="#makeStudyActive (instance method)">- (Object) <strong>makeStudyActive</strong>(myStudy) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
make the study session active possibly deprecated?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-instance_method" title="#new (instance method)">- (Object) <strong>new</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
show the new study form page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#outcomes-instance_method" title="#outcomes (instance method)">- (Object) <strong>outcomes</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays outcome setup page - form to add new outcomes and timepoints.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#publications-instance_method" title="#publications (instance method)">- (Object) <strong>publications</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays study publication information page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#quality-instance_method" title="#quality (instance method)">- (Object) <strong>quality</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays study quality page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#questions-instance_method" title="#questions (instance method)">- (Object) <strong>questions</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays study key questions page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#results-instance_method" title="#results (instance method)">- (Object) <strong>results</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays table for each outcome that enables data entry for each outcome
timepoint and arm.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">- (Object) <strong>show</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
displays study summary page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">- (Object) <strong>update</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
update an existing study.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#escape_quotes-instance_method" title="ApplicationController#escape_quotes (method)">#escape_quotes</a></span>, <span class='object_link'><a href="ApplicationController.html#set_as_current-instance_method" title="ApplicationController#set_as_current (method)">#set_as_current</a></span>, <span class='object_link'><a href="ApplicationController.html#show_other-instance_method" title="ApplicationController#show_other (method)">#show_other</a></span>, <span class='object_link'><a href="ApplicationController.html#show_other_filled-instance_method" title="ApplicationController#show_other_filled (method)">#show_other_filled</a></span>, <span class='object_link'><a href="ApplicationController.html#toggle_ahrq_header-instance_method" title="ApplicationController#toggle_ahrq_header (method)">#toggle_ahrq_header</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="adverse-instance_method">
  
    - (<tt>Object</tt>) <strong>adverse</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays study adverse event page.  contains table to add rows and adverse
event data points to
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 431</span>

<span class='kw'>def</span> <span class='id identifier rubyid_adverse'>adverse</span>
<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
<span class='comment'># an array of hashes to keep track of key questions addressed by
</span><span class='comment'># each individual section
</span><span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
		<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
		<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
		<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
	<span class='kw'>end</span>
<span class='kw'>end</span>
<span class='ivar'>@ef_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span>
<span class='kw'>if</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_section_is_included'>section_is_included</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adverse</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@ef_id</span><span class='rparen'>)</span>
	<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@ef_id</span><span class='rparen'>)</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@adverse_events</span> <span class='op'>=</span> <span class='const'>AdverseEvent</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span> <span class='symbol'>:conditions</span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>study_id=? AND extraction_form_id = ?</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@ef_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@adverse_event</span> <span class='op'>=</span> <span class='const'>AdverseEvent</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@arms</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>study_id = ? AND extraction_form_id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='ivar'>@ef_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:order</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>display_number ASC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='ivar'>@extraction_form_adverse_event_columns</span> <span class='op'>=</span> <span class='const'>AdverseEventColumn</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extraction_form_id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@ef_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@adverse_event_result</span> <span class='op'>=</span> <span class='const'>AdverseEventResult</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@num_rows</span> <span class='op'>=</span> <span class='int'>0</span>
	<span class='kw'>if</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_adverse_event_display_arms'>adverse_event_display_arms</span>
		<span class='ivar'>@num_rows</span> <span class='op'>=</span> <span class='ivar'>@num_rows</span> <span class='op'>+</span> <span class='ivar'>@arms</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
	<span class='kw'>end</span>
	<span class='kw'>if</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_adverse_event_display_total'>adverse_event_display_total</span>
		<span class='ivar'>@num_rows</span> <span class='op'>=</span> <span class='ivar'>@num_rows</span> <span class='op'>+</span> <span class='int'>1</span>
	<span class='kw'>end</span>					
<span class='kw'>else</span>
	<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>That section is not included in the current extraction form.</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_project_study_path'>edit_project_study_path</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>				
<span class='kw'>end</span>		
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="arms-instance_method">
  
    - (<tt>Object</tt>) <strong>arms</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays study interventions page.  contains study arm information
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 205</span>

<span class='kw'>def</span> <span class='id identifier rubyid_arms'>arms</span>
	<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
	<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	
<span class='comment'># get information regarding the extraction forms, pre-defined outcomes, outcome descriptions,
</span>   <span class='comment'># sections in each form, sections borrowed from other forms, key questions associated with 
</span>   <span class='comment'># each section, etc.
</span>   <span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
   				<span class='ivar'>@extraction_forms</span><span class='comma'>,</span><span class='ivar'>@arm_options</span><span class='comma'>,</span><span class='ivar'>@descriptions</span><span class='comma'>,</span><span class='ivar'>@included_sections</span><span class='comma'>,</span><span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span><span class='ivar'>@section_donor_ids</span><span class='comma'>,</span><span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_get_extraction_form_information'>get_extraction_form_information</span><span class='lparen'>(</span><span class='ivar'>@study_extforms</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
	<span class='kw'>end</span>

	<span class='kw'>if</span> <span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>arms</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='ivar'>@arm</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@arms</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>display_number ASC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  
	<span class='kw'>else</span>
		<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>That section is not included in the current extraction form.</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_project_study_path'>edit_project_study_path</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>				
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="baselines-instance_method">
  
    - (<tt>Object</tt>) <strong>baselines</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays study baseline characteristics page contains the question builder
and template sections for baseline characteristics
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 269</span>

<span class='kw'>def</span> <span class='id identifier rubyid_baselines'>baselines</span>
<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@arms</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>		
<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
<span class='comment'># an array of hashes to keep track of key questions addressed by
</span><span class='comment'># each individual section
</span><span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
		<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
		<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
		<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
	<span class='kw'>end</span>
<span class='kw'>end</span>
<span class='kw'>if</span> <span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baselines</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='ivar'>@baseline_characteristic</span> <span class='op'>=</span> <span class='const'>BaselineCharacteristic</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='comment'>#@baseline_characteristic_extraction_form_fields = BaselineCharacteristic.where(:extraction_form_id=&gt;@extraction_form.id, :study_id =&gt; nil).order(&quot;question_number ASC&quot;)
</span>	<span class='ivar'>@baseline_characteristic_extraction_form_fields</span> <span class='op'>=</span> <span class='const'>BaselineCharacteristic</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>question_number ASC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='comment'>#@baseline_characteristic_custom_fields = BaselineCharacteristic.where(:study_id=&gt;@study.id, :extraction_form_id =&gt; @extraction_form.id).order(&quot;question_number ASC&quot;)
</span>	<span class='ivar'>@baseline_characteristic_custom_fields</span> <span class='op'>=</span> <span class='const'>BaselineCharacteristic</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>question_number ASC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='ivar'>@baseline_characteristic_data_point</span> <span class='op'>=</span> <span class='const'>BaselineCharacteristicDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>else</span>
	<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>That section is not included in the current extraction form.</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_project_study_path'>edit_project_study_path</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>				
<span class='kw'>end</span>	
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="clearSessionStudyInfo-instance_method">
  
    - (<tt>Object</tt>) <strong>clearSessionStudyInfo</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
set the session data to nil possibly deprecated?
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


724
725
726
727</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 724</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clearSessionStudyInfo'>clearSessionStudyInfo</span>
	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:study_title</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="comparisons-instance_method">
  
    - (<tt>Object</tt>) <strong>comparisons</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'></div></div>
<p>
shows the study comparisons page no longer used - outcome comparisons and
results tables are combined into &#8216;results&#8217;
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 390</span>

<span class='kw'>def</span> <span class='id identifier rubyid_comparisons'>comparisons</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
	<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
	<span class='comment'># an array of hashes to keep track of key questions addressed by
</span>	<span class='comment'># each individual section
</span>	<span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@saved_comparisons</span> <span class='op'>=</span> <span class='const'>Comparison</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>within_or_between ASC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='ivar'>@comparison_titles</span><span class='comma'>,</span><span class='ivar'>@saved_measures</span><span class='comma'>,</span> <span class='ivar'>@saved_data_points</span> <span class='op'>=</span> <span class='const'>Comparison</span><span class='period'>.</span><span class='id identifier rubyid_get_comparison_details'>get_comparison_details</span><span class='lparen'>(</span><span class='ivar'>@saved_comparisons</span><span class='rparen'>)</span>
	<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
			<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
			<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
			<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
			<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
			<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
			<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
			<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	<span class='kw'>if</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_section_is_included'>section_is_included</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comparisons</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@arms</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='ivar'>@outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='ivar'>@outcome_timepoints</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_get_timepoints_for_outcomes'>get_timepoints_for_outcomes</span><span class='lparen'>(</span><span class='ivar'>@outcomes</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_oc'>oc</span><span class='op'>|</span> <span class='id identifier rubyid_oc'>oc</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='rparen'>)</span>
		<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@study_arms</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>That section is not included in the current extraction form.</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_project_study_path'>edit_project_study_path</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>				
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="create-instance_method">
  
    - (<tt>Object</tt>) <strong>create</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
create a new study
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 533</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='kw'>unless</span> <span class='lparen'>(</span><span class='op'>!</span><span class='kw'>defined?</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
 		<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	
		<span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
			<span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_creator_id'>creator_id</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
		<span class='kw'>end</span>
		
		<span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
		<span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_assign_kqs_and_efs'>assign_kqs_and_efs</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span>
		<span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
		<span class='comment'># add default information to be included in this study
</span>		<span class='comment'># this can be things like study arms, outcomes, etc.
</span>		<span class='comment'>#@study.set_defaults	
</span>		<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>	
		<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
	
		<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

		<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
		<span class='comment'># an array of hashes to keep track of key questions addressed by
</span>		<span class='comment'># each individual section
</span>		<span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
				<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
				<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
				<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
				<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
				<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
				<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
				<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
				<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>
		<span class='comment'># get info on primary publication
</span>		<span class='ivar'>@primary_publication</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_get_primary_publication'>get_primary_publication</span>
		<span class='ivar'>@primary_publication</span> <span class='op'>=</span> <span class='ivar'>@primary_publication</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='const'>PrimaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='ivar'>@primary_publication</span>
		<span class='ivar'>@primary_publication_numbers</span> <span class='op'>=</span> <span class='const'>PrimaryPublicationNumber</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:primary_publication_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@primary_publication</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='comment'># get info on secondary publications
</span>		<span class='ivar'>@secondary_publications</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_get_secondary_publications'>get_secondary_publications</span><span class='lparen'>(</span><span class='ivar'>@extform</span><span class='rparen'>)</span>
		<span class='ivar'>@secondary_publication</span> <span class='op'>=</span> <span class='const'>SecondaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/projects/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_content'>/studies/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_content'>/publications</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>else</span>
			<span class='id identifier rubyid_problem_html'>problem_html</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Studies must be associated with at least one key question.</span><span class='tstring_end'>&quot;</span></span>
			<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error_message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_problem_html'>problem_html</span>
	<span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="create_for_pmid_list-instance_method">
  
    - (<tt>Object</tt>) <strong>create_for_pmid_list</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Given a list of pubmed identifiers from the user,  create a corresponding
study for each. The method to  do this is found in the Study model
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 594</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_for_pmid_list'>create_for_pmid_list</span>
	<span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:pmids</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='comment'># get the information that we'll pass to the Study model
</span>		<span class='id identifier rubyid_pubmeds'>pubmeds</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:pmids</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_kqs'>kqs</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_project'>project</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_extraction_form'>extraction_form</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
		
		<span class='ivar'>@id_list</span> <span class='op'>=</span> <span class='id identifier rubyid_pubmeds'>pubmeds</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='comment'># create the studies for each pubmed id and get an array
</span>		<span class='comment'># of those that were problematic
</span>		<span class='ivar'>@problem_entries</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_create_for_pmids'>create_for_pmids</span><span class='lparen'>(</span><span class='ivar'>@id_list</span><span class='comma'>,</span> <span class='id identifier rubyid_kqs'>kqs</span><span class='comma'>,</span> <span class='id identifier rubyid_project'>project</span><span class='comma'>,</span> <span class='id identifier rubyid_extraction_form'>extraction_form</span><span class='comma'>,</span> <span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
		
		<span class='ivar'>@studies</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_project'>project</span><span class='rparen'>)</span>
		<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_project'>project</span><span class='rparen'>)</span>
		
		<span class='kw'>if</span> <span class='ivar'>@problem_entries</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>0</span>
			<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:success_message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>All studies were successfully created.</span><span class='tstring_end'>'</span></span>
		<span class='kw'>elsif</span> <span class='ivar'>@problem_entries</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@problem_entries</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='ivar'>@id_list</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
			<span class='id identifier rubyid_successful'>successful</span> <span class='op'>=</span> <span class='ivar'>@id_list</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='ivar'>@problem_entries</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
			<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:success_message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Successfully created studies for </span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_successful'>successful</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> of the </span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='ivar'>@id_list</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> PubMed IDs.</span><span class='tstring_end'>'</span></span>
			<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error_message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not find information for the following PMIDs: &lt;br/&gt;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@problem_entries</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>else</span>
			<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error_message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: Could not obtain information for any of the supplied PubMed IDs.</span><span class='tstring_end'>&quot;</span></span>
		<span class='kw'>end</span>
		
		<span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
			<span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span><span class='lbrace'>{</span>
				<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/projects/</span><span class='tstring_end'>'</span></span><span class='op'>+</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='op'>+</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/studies/</span><span class='tstring_end'>'</span></span>
			<span class='rbrace'>}</span>
		<span class='kw'>end</span>
	<span class='kw'>else</span>
		<span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
			<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Studies must be associated with at least one key question.</span><span class='tstring_end'>&quot;</span></span>
		<span class='kw'>elsif</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:pmids</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please enter a list of pubmed IDs separated by at least one space or line.</span><span class='tstring_end'>&quot;</span></span>
		<span class='kw'>end</span>
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='symbol'>:back</span>
	<span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="design-instance_method">
  
    - (<tt>Object</tt>) <strong>design</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays study design details page contains the question builder and
template sections for design details
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 230</span>

<span class='kw'>def</span> <span class='id identifier rubyid_design'>design</span>
  	<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  	<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
  	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
  	<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
		<span class='comment'># an array of hashes to keep track of key questions addressed by
</span>		<span class='comment'># each individual section
</span>		<span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@design_detail_extraction_form_fields</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
	  		<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
	  		<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
				<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
				<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
				<span class='comment'>#if included.include?(&quot;design&quot;) &amp;&amp; !borrowed.include?(&quot;design&quot;)
</span>				<span class='comment'>#	@design_detail_extraction_form_fields += DesignDetail.where(:extraction_form_id=&gt;ef.extraction_form_id, :study_id=&gt;nil)
</span>				<span class='comment'>#end
</span>				<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
				<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
				<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
				<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
	  	<span class='kw'>end</span>
	<span class='kw'>end</span>
	<span class='kw'>if</span> <span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>design</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='ivar'>@design_detail</span> <span class='op'>=</span> <span class='const'>DesignDetail</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@design_detail_extraction_form_fields</span> <span class='op'>=</span> <span class='const'>DesignDetail</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>question_number ASC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='ivar'>@design_detail_data_point</span> <span class='op'>=</span> <span class='const'>DesignDetailDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>That section is not included in the current extraction form.</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_project_study_path'>edit_project_study_path</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>				
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="destroy-instance_method">
  
    - (<tt>Object</tt>) <strong>destroy</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
destroy a study
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 686</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
  <span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_remove_from_key_question_junction'>remove_from_key_question_junction</span>
  <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_remove_from_extraction_form_junction'>remove_from_extraction_form_junction</span>
  <span class='comment'># remove any baseline characteristics associated with the study
</span>  <span class='id identifier rubyid_baselines'>baselines</span> <span class='op'>=</span> <span class='const'>BaselineCharacteristicDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_baselines'>baselines</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_baselines'>baselines</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_base'>base</span><span class='op'>|</span>
   		<span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
 		<span class='kw'>end</span>
	<span class='kw'>end</span>
	
	<span class='comment'># remove any design details associated with the study
</span>	<span class='id identifier rubyid_designs'>designs</span> <span class='op'>=</span> <span class='const'>DesignDetailDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='kw'>unless</span> <span class='id identifier rubyid_designs'>designs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='id identifier rubyid_designs'>designs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_des'>des</span><span class='op'>|</span>
			<span class='id identifier rubyid_des'>des</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
  <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='symbol'>:back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="edit-instance_method">
  
    - (<tt>Object</tt>) <strong>edit</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays study editing page
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 75</span>

<span class='kw'>def</span> <span class='id identifier rubyid_edit'>edit</span>
<span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>To add a new study, please choose a systematic review first.</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_projects_paths'>projects_paths</span>
<span class='kw'>else</span> 
   	<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
   
<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
<span class='comment'># an array of hashes to keep track of key questions addressed by
</span><span class='comment'># each individual section
</span><span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
		<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
  		<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
		<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
		<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
 		<span class='kw'>end</span>
<span class='kw'>end</span>	  
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span> 
<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>	
<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
<span class='comment'># get the study title, which is the same as the primary publication for the study
</span><span class='ivar'>@study_title</span> <span class='op'>=</span> <span class='const'>PrimaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='ivar'>@study_title</span> <span class='op'>=</span> <span class='ivar'>@study_title</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='ivar'>@study_title</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>	
<span class='ivar'>@extraction_form_list_array</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_get_extraction_form_list_array'>get_extraction_form_list_array</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@study_extraction_form</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>			
<span class='ivar'>@ext_forms_list</span> <span class='op'>=</span> <span class='ivar'>@study_extforms</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="extractionforms-instance_method">
  
    - (<tt>Object</tt>) <strong>extractionforms</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays study extraction form page.  enables the user to view and edit the
extraction forms associated with this study
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 116</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extractionforms'>extractionforms</span>
	<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>		
<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span> 
<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>	
<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>

<span class='comment'># get the study title, which is the same as the primary publication for the study
</span><span class='ivar'>@study_title</span> <span class='op'>=</span> <span class='const'>PrimaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='ivar'>@study_title</span> <span class='op'>=</span> <span class='ivar'>@study_title</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='ivar'>@study_title</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='ivar'>@extraction_form_list_array</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_get_extraction_form_list_array'>get_extraction_form_list_array</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>		
<span class='ivar'>@study_extraction_form</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@ext_forms_list</span> <span class='op'>=</span> <span class='ivar'>@study_extforms</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_questions_params-instance_method">
  
    - (<tt>array</tt>) <strong>get_questions_params</strong>(form_params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
get an array based on form parameters being submitted
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>form_params</span>
      
      
        <span class='type'>(<tt>hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
form parameters submitted
</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
resulting array
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


712
713
714
715
716
717
718
719
720</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 712</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_questions_params'>get_questions_params</span><span class='lparen'>(</span><span class='id identifier rubyid_form_params'>form_params</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_questions'>questions</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='id identifier rubyid_form_params'>form_params</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
		<span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^question_</span><span class='regexp_end'>/</span></span>
			<span class='id identifier rubyid_questions'>questions</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>question_</span><span class='regexp_end'>/</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	<span class='kw'>return</span> <span class='id identifier rubyid_questions'>questions</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="index-instance_method">
  
    - (<tt>Object</tt>) <strong>index</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
shows list of studies for the project with id = params[:project_id]
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38
39
40
41
42
43
44
45
46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 36</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  	<span class='ivar'>@studies</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@project_ready_for_studies</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_is_ready_for_studies'>is_ready_for_studies</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
		<span class='ivar'>@project_extraction_forms</span> <span class='op'>=</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_extraction_forms'>extraction_forms</span>
		<span class='comment'># get current user extraction_forms to show number available
</span>		<span class='kw'>if</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='ivar'>@user_extraction_forms</span> <span class='op'>=</span> <span class='kw'>nil</span>
		<span class='kw'>else</span>
<span class='ivar'>@extraction_form_list_array</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_get_extraction_form_list_array'>get_extraction_form_list_array</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>	
<span class='ivar'>@user_extraction_forms</span> <span class='op'>=</span> <span class='ivar'>@extraction_form_list_array</span>
		<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="index_pdf-instance_method">
  
    - (<tt>Object</tt>) <strong>index_pdf</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
show the print layout in order to export a study summary to pdf.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 10</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index_pdf'>index_pdf</span>
<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>	
<span class='ivar'>@study_qs</span> <span class='op'>=</span> <span class='const'>StudyKeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='ivar'>@study_questions</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='ivar'>@study_qs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='ivar'>@study_questions</span> <span class='op'>&lt;&lt;</span> <span class='const'>KeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_key_question_id'>key_question_id</span><span class='rparen'>)</span><span class='rbrace'>}</span>
<span class='ivar'>@study_questions</span><span class='period'>.</span><span class='id identifier rubyid_sort!'>sort!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_question_number'>question_number</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_question_number'>question_number</span> <span class='rbrace'>}</span>	
<span class='ivar'>@primary_publication</span> <span class='op'>=</span> <span class='const'>PrimaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='ivar'>@secondary_publications</span> <span class='op'>=</span> <span class='const'>SecondaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>	
<span class='ivar'>@study_arms</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>	
<span class='ivar'>@outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='ivar'>@adverse_events</span> <span class='op'>=</span> <span class='const'>AdverseEvent</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='ivar'>@categorical_outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:outcome_type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Categorical</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='ivar'>@continuous_outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:outcome_type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Continuous</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>		
<span class='ivar'>@outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='comment'># get the study title, which is the same as the primary publication for the study
</span><span class='ivar'>@study_title</span> <span class='op'>=</span> <span class='const'>PrimaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='ivar'>@study_title</span> <span class='op'>=</span> <span class='ivar'>@study_title</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='ivar'>@study_title</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>	
<span class='ivar'>@baseline_characteristic_custom_fields</span> <span class='op'>=</span> <span class='const'>BaselineCharacteristic</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>   
<span class='id identifier rubyid_render'>render</span> <span class='symbol'>:pdf</span> <span class='op'>=&gt;</span> <span class='ivar'>@study_title</span><span class='comma'>,</span> <span class='symbol'>:template</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>studies/show_print.html.erb</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:layout</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>print</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:disable_javascript</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:header</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:center</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SRDR Extracted Study Data</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="makeStudyActive-instance_method">
  
    - (<tt>Object</tt>) <strong>makeStudyActive</strong>(myStudy) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
make the study session active possibly deprecated?
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


731
732
733
734
735
736
737
738
739
740
741</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 731</span>

<span class='kw'>def</span> <span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span> <span class='id identifier rubyid_myStudy'>myStudy</span>
	<span class='id identifier rubyid_clearSessionStudyInfo'>clearSessionStudyInfo</span><span class='lparen'>(</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_myStudy'>myStudy</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
	<span class='ivar'>@primary_pub</span> <span class='op'>=</span> <span class='id identifier rubyid_myStudy'>myStudy</span><span class='period'>.</span><span class='id identifier rubyid_get_primary_publication'>get_primary_publication</span>
	<span class='kw'>if</span> <span class='lparen'>(</span><span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@primary_pub</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='ivar'>@primary_pub</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:study_title</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@primary_pub</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span>
	<span class='kw'>else</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:study_title</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not Entered Yet</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span>
	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="new-instance_method">
  
    - (<tt>Object</tt>) <strong>new</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
show the new study form page
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


519
520
521
522
523
524
525
526
527
528
529
530</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 519</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>    
	<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@ready_for_studies</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_is_ready_for_studies'>is_ready_for_studies</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@key_questions</span> <span class='op'>=</span> <span class='const'>KeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:project_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>question_number ASC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='comment'># return an array telling us whether or not each question is represented by a form
</span>	<span class='comment'># will be a hash:  qid -&gt; true/false
</span>	<span class='ivar'>@available</span> <span class='op'>=</span> <span class='const'>KeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_has_extraction_form_assigned'>has_extraction_form_assigned</span><span class='lparen'>(</span><span class='ivar'>@key_questions</span><span class='rparen'>)</span>
	<span class='comment'>#added this line in case the user is coming from Home
</span>	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> 
	<span class='id identifier rubyid_render'>render</span> <span class='symbol'>:layout</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>application</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="outcomes-instance_method">
  
    - (<tt>Object</tt>) <strong>outcomes</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays outcome setup page - form to add new outcomes and timepoints
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 308</span>

<span class='kw'>def</span> <span class='id identifier rubyid_outcomes'>outcomes</span>
	<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@project</span><span class='op'>=</span><span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@outcome_subgroups</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
	<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='comment'># get information regarding the extraction forms, pre-defined outcomes, outcome descriptions,
</span>	<span class='comment'># sections in each form, sections borrowed from other forms, key questions associated with 
</span>	<span class='comment'># each section, etc.
</span>	<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='ivar'>@extraction_forms</span><span class='comma'>,</span><span class='ivar'>@outcome_options</span><span class='comma'>,</span><span class='ivar'>@descriptions</span><span class='comma'>,</span><span class='ivar'>@included_sections</span><span class='comma'>,</span><span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span><span class='ivar'>@section_donor_ids</span><span class='comma'>,</span><span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_get_extraction_form_information'>get_extraction_form_information</span><span class='lparen'>(</span><span class='ivar'>@study_extforms</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='comma'>,</span><span class='ivar'>@project</span><span class='rparen'>)</span>
	<span class='kw'>end</span>
	
	<span class='kw'>if</span> <span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outcomes</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='ivar'>@study_arms</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='ivar'>@outcome</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span>  <span class='ivar'>@extraction_form</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='ivar'>@outcome_subgroups_hash</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_get_subgroups_by_outcome'>get_subgroups_by_outcome</span><span class='lparen'>(</span><span class='ivar'>@outcomes</span><span class='rparen'>)</span>
		<span class='ivar'>@outcome_timepoint</span> <span class='op'>=</span> <span class='const'>OutcomeTimepoint</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@time_units</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_get_timepoint_unit_options'>get_timepoint_unit_options</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
		<span class='ivar'>@editing</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:editing</span><span class='rbracket'>]</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>That section is not included in the current extraction form.</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_project_study_path'>edit_project_study_path</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>				
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="publications-instance_method">
  
    - (<tt>Object</tt>) <strong>publications</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays study publication information page.  contains the primary and
secondary publication information and id number entry for each
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 170</span>

<span class='kw'>def</span> <span class='id identifier rubyid_publications'>publications</span>
<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span> 
<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
<span class='comment'># an array of hashes to keep track of key questions addressed by
</span><span class='comment'># each individual section
</span><span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
		<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
		<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
		<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
	<span class='kw'>end</span>
<span class='kw'>end</span>
<span class='comment'># get info on primary publication
</span><span class='ivar'>@primary_publication</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_get_primary_publication'>get_primary_publication</span>
<span class='ivar'>@primary_publication</span> <span class='op'>=</span> <span class='ivar'>@primary_publication</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='const'>PrimaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='ivar'>@primary_publication</span>
<span class='ivar'>@primary_publication_numbers</span> <span class='op'>=</span> <span class='const'>PrimaryPublicationNumber</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:primary_publication_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@primary_publication</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='comment'># get info on secondary publications
</span><span class='ivar'>@secondary_publications</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_get_secondary_publications'>get_secondary_publications</span><span class='lparen'>(</span><span class='ivar'>@extform</span><span class='rparen'>)</span>
<span class='ivar'>@secondary_publication</span> <span class='op'>=</span> <span class='const'>SecondaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="quality-instance_method">
  
    - (<tt>Object</tt>) <strong>quality</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays study quality page.  contains a quality dimensions data table, 
and a dropdown menu to choose a rating for the study in progress
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 479</span>

<span class='kw'>def</span> <span class='id identifier rubyid_quality'>quality</span>
	<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='comment'>#makeStudyActive(@study)
</span>	<span class='comment'>#session[:project_id] = @study.project_id
</span>	<span class='ivar'>@extraction_form</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
	<span class='comment'># an array of hashes to keep track of key questions addressed by
</span>	<span class='comment'># each individual section
</span>	<span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
			<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
			<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
			<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
			<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
			<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
			<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
			<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	<span class='ivar'>@ef_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span>
	<span class='kw'>if</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_section_is_included'>section_is_included</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>quality</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@ef_id</span><span class='rparen'>)</span>	
		<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
		<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@exists</span> <span class='op'>=</span> <span class='const'>QualityRatingDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@ef_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
		<span class='ivar'>@quality_rating</span> <span class='op'>=</span> <span class='ivar'>@exists</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='const'>QualityRatingDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='op'>:</span> <span class='ivar'>@exists</span>
		<span class='ivar'>@quality_dimension_field</span> <span class='op'>=</span> <span class='const'>QualityDimensionField</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@quality_dimension_data_point</span> <span class='op'>=</span> <span class='const'>QualityDimensionDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@quality_dimension_extraction_form_fields</span> <span class='op'>=</span> <span class='const'>QualityDimensionField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@ef_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>That section is not included in the current extraction form.</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_project_study_path'>edit_project_study_path</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>				
	<span class='kw'>end</span>	
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="questions-instance_method">
  
    - (<tt>Object</tt>) <strong>questions</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays study key questions page.  presents a list of key questions, where
the user can choose which ones this particular study answers
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 135</span>

<span class='kw'>def</span> <span class='id identifier rubyid_questions'>questions</span>
   <span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
   <span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
   <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
	<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
	<span class='comment'># an array of hashes to keep track of key questions addressed by
</span>	<span class='comment'># each individual section
</span>	<span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>		
	<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
			<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
			<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
			<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
			<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
			<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
			<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
			<span class='comment'>#@borrowed_sections[ef.extraction_form_id] = borrowed
</span>			<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
  	<span class='kw'>end</span>
	<span class='kw'>end</span>	
	<span class='ivar'>@ef_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span>
	<span class='comment'># get info on questions addressed
</span>	<span class='ivar'>@questions</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_get_question_choices'>get_question_choices</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>	
	<span class='comment'># return an array telling us whether or not each question is represented by a form
</span>	<span class='comment'># will be a hash:  qid -&gt; true/false
</span>	<span class='ivar'>@available</span> <span class='op'>=</span> <span class='const'>KeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_has_extraction_form_assigned'>has_extraction_form_assigned</span><span class='lparen'>(</span><span class='ivar'>@questions</span><span class='rparen'>)</span>	
	<span class='ivar'>@checked_ids</span> <span class='op'>=</span> <span class='const'>StudyKeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_rec'>rec</span><span class='op'>|</span> <span class='id identifier rubyid_rec'>rec</span><span class='period'>.</span><span class='id identifier rubyid_key_question_id'>key_question_id</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="results-instance_method">
  
    - (<tt>Object</tt>) <strong>results</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays table for each outcome that enables data entry for each outcome
timepoint and arm
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 339</span>

<span class='kw'>def</span> <span class='id identifier rubyid_results'>results</span>
<span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:existing_results</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_get_existing_results_for_session'>get_existing_results_for_session</span>
<span class='id identifier rubyid_ocdes'>ocdes</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_get_data_entries'>get_data_entries</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:existing_comparisons</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>OutcomeDataEntry</span><span class='period'>.</span><span class='id identifier rubyid_get_existing_comparisons_for_session'>get_existing_comparisons_for_session</span><span class='lparen'>(</span><span class='id identifier rubyid_ocdes'>ocdes</span><span class='rparen'>)</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:study_arms</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_arms'>arms</span>
  
<span class='id identifier rubyid_makeStudyActive'>makeStudyActive</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='rparen'>)</span>
<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
<span class='comment'># an array of hashes to keep track of key questions addressed by
</span><span class='comment'># each individual section
</span><span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
		<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
		<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
		<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
	<span class='kw'>end</span>
<span class='kw'>end</span>
<span class='kw'>if</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_section_is_included'>section_is_included</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>results</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@arms</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span>
	<span class='ivar'>@cont_outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:outcome_type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Continuous</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>	
	<span class='ivar'>@cat_outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:outcome_type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Categorical</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@survival_outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:outcome_type</span> <span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Survival</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='ivar'>@timepoints_hash</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_get_timepoints_hash'>get_timepoints_hash</span><span class='lparen'>(</span><span class='ivar'>@cont_outcomes</span> <span class='op'>+</span> <span class='ivar'>@cat_outcomes</span><span class='rparen'>)</span>

	<span class='comment'># GET THE SUBGROUPS ASSOCIATED WITH THESE OUTCOMES
</span>	<span class='id identifier rubyid_ocs'>ocs</span> <span class='op'>=</span> <span class='ivar'>@cont_outcomes</span> <span class='op'>+</span> <span class='ivar'>@cat_outcomes</span> <span class='op'>+</span> <span class='ivar'>@survival_outcomes</span>
	<span class='ivar'>@outcome_subgroups</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_get_subgroups_by_outcome'>get_subgroups_by_outcome</span><span class='lparen'>(</span><span class='id identifier rubyid_ocs'>ocs</span><span class='rparen'>)</span>
	<span class='ivar'>@subgroups</span> <span class='op'>=</span> <span class='ivar'>@outcome_subgroups</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>else</span>
	<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>That section is not included in the current extraction form.</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_project_study_path'>edit_project_study_path</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>				
<span class='kw'>end</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n\nSession keys is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:existing_comparisons</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:within</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='rbrace'>}</span><span class='tstring_content'>\n\n\n</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="show-instance_method">
  
    - (<tt>Object</tt>) <strong>show</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
displays study summary page.  shows all data tables and section information
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 52</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:project_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>	
		<span class='ivar'>@study_qs</span> <span class='op'>=</span> <span class='const'>StudyKeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='ivar'>@study_questions</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
		<span class='ivar'>@study_qs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='ivar'>@study_questions</span> <span class='op'>&lt;&lt;</span> <span class='const'>KeyQuestion</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_key_question_id'>key_question_id</span><span class='rparen'>)</span><span class='rbrace'>}</span>
		<span class='ivar'>@study_questions</span><span class='period'>.</span><span class='id identifier rubyid_sort!'>sort!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_question_number'>question_number</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_question_number'>question_number</span> <span class='rbrace'>}</span>	
		<span class='ivar'>@primary_publication</span> <span class='op'>=</span> <span class='const'>PrimaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
		<span class='ivar'>@secondary_publications</span> <span class='op'>=</span> <span class='const'>SecondaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>	
		<span class='ivar'>@study_arms</span> <span class='op'>=</span> <span class='const'>Arm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>	
		<span class='ivar'>@outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='ivar'>@adverse_events</span> <span class='op'>=</span> <span class='const'>AdverseEvent</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='ivar'>@categorical_outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:outcome_type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Categorical</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='ivar'>@continuous_outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:outcome_type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Continuous</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>		
		<span class='ivar'>@outcomes</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
		<span class='comment'># get the study title, which is the same as the primary publication for the study
</span>		<span class='ivar'>@study_title</span> <span class='op'>=</span> <span class='const'>PrimaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
		<span class='ivar'>@study_title</span> <span class='op'>=</span> <span class='ivar'>@study_title</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='ivar'>@study_title</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>	
		<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>		
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update-instance_method">
  
    - (<tt>Object</tt>) <strong>update</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
update an existing study
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/studies_controller.rb', line 638</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
  <span class='ivar'>@study</span> <span class='op'>=</span> <span class='const'>Study</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'>Project</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span><span class='rparen'>)</span>
<span class='comment'>#@project = Project.find(session[:project_id])
</span><span class='comment'>#@study = Study.set_study_type(params, @study)
</span>  <span class='kw'>if</span> <span class='ivar'>@saved</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes'>update_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:study</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_questions_flag'>questions_flag</span> <span class='op'>=</span> <span class='kw'>false</span>
	<span class='id identifier rubyid_questions'>questions</span> <span class='op'>=</span> <span class='id identifier rubyid_get_questions_params'>get_questions_params</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
	<span class='comment'># if we're updating from the key question form,
</span>	<span class='comment'># remove previously saved questions for this study
</span>	<span class='id identifier rubyid_kq_error'>kq_error</span> <span class='op'>=</span> <span class='kw'>false</span>
	<span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:updating_kq</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
		<span class='comment'># if there are question parameters, save the new entries
</span>		<span class='kw'>unless</span> <span class='id identifier rubyid_questions'>questions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_assign_questions'>assign_questions</span><span class='lparen'>(</span><span class='id identifier rubyid_questions'>questions</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:extraction_form_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='kw'>else</span>
			<span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This operation is not allowed. Studies must be associated with at least one key question.</span><span class='tstring_end'>&quot;</span></span>
			<span class='id identifier rubyid_kq_error'>kq_error</span> <span class='op'>=</span> <span class='kw'>true</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
<span class='kw'>end</span>
<span class='ivar'>@study_extforms</span> <span class='op'>=</span> <span class='const'>StudyExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
<span class='ivar'>@extraction_forms</span> <span class='op'>=</span> <span class='ivar'>@study</span><span class='period'>.</span><span class='id identifier rubyid_get_extraction_forms'>get_extraction_forms</span>
<span class='ivar'>@included_sections</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='ivar'>@borrowed_section_names</span><span class='comma'>,</span> <span class='ivar'>@section_donor_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
<span class='comment'># an array of hashes to keep track of key questions addressed by
</span><span class='comment'># each individual section
</span><span class='ivar'>@kqs_per_section</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>unless</span> <span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	<span class='ivar'>@study_extforms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span>
		<span class='id identifier rubyid_tmpForm'>tmpForm</span> <span class='op'>=</span> <span class='const'>ExtractionForm</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@extraction_forms</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmpForm'>tmpForm</span>
		<span class='id identifier rubyid_included'>included</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_included_sections'>get_included_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_borrowed'>borrowed</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_borrowed_sections'>get_borrowed_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rparen'>)</span>
		<span class='ivar'>@included_sections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_included'>included</span>
		<span class='ivar'>@borrowed_section_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@section_donor_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_borrowed'>borrowed</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
		<span class='ivar'>@kqs_per_section</span><span class='lbracket'>[</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ExtractionFormSection</span><span class='period'>.</span><span class='id identifier rubyid_get_questions_per_section'>get_questions_per_section</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span><span class='ivar'>@study</span><span class='rparen'>)</span>
	<span class='kw'>end</span>
<span class='kw'>end</span>	
<span class='ivar'>@message_div</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>saved_item_indicator</span><span class='tstring_end'>&quot;</span></span>
<span class='ivar'>@table_container</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>right_side_nav</span><span class='tstring_end'>&quot;</span></span>
<span class='ivar'>@table_partial</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sidebars/study_edit</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>shared/saved.js.erb</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Wed Feb  1 16:26:51 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.4 (ruby-1.9.2).
</div>

  </body>
</html>