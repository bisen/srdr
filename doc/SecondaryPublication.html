<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: SecondaryPublication
  
    &mdash; Documentation by YARD 0.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (S)</a> &raquo; 
    
    
    <span class="title">SecondaryPublication</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: SecondaryPublication
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">SecondaryPublication</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/models/secondary_publication.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This class handles secondary publications for a study. A study can have
unlimited secondary publications. A secondary publication can have many
secondary publication numbers.
</p>


  </div>
</div>
<div class="tags">
  

</div>

  


  

  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decrease_other-class_method" title="decrease_other (class method)">+ (Object) <strong>decrease_other</strong>(num, study_id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
decrement display number (ordering number) of a secondary publication.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_pub_uis-class_method" title="get_pub_uis (class method)">+ (array) <strong>get_pub_uis</strong>(pub_id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
get secondary publication numbers based on the secondary publication id.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_summary_info_by_pmid-class_method" title="get_summary_info_by_pmid (class method)">+ (array) <strong>get_summary_info_by_pmid</strong>(pmid) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Given an pubmed ID, return author, title, year, etc.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#move_up_this-class_method" title="move_up_this (class method)">+ (Object) <strong>move_up_this</strong>(id, study_id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
increment display number (ordering number) of a secondary publication based
on the secondary publication id.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_display_number-instance_method" title="#get_display_number (instance method)">- (integer) <strong>get_display_number</strong>(study_id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
get the next consecutive display number (ordering number) of a secondary
publication based on the study id.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shift_display_numbers-instance_method" title="#shift_display_numbers (instance method)">- (Object) <strong>shift_display_numbers</strong>(study_id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
adjust the display numbers (ordering numbers) of a secondary publication
based on the study id.
</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="decrease_other-class_method">
  
    + (<tt>Object</tt>) <strong>decrease_other</strong>(num, study_id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
decrement display number (ordering number) of a secondary publication. 
used in move_up_this(id, study_id)
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>num</span>
      
      
        <span class='type'>(<tt>integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the display number to decrement
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>study_id</span>
      
      
        <span class='type'>(<tt>integer</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/secondary_publication.rb', line 56</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_decrease_other'>decrease_other</span><span class='lparen'>(</span><span class='id identifier rubyid_num'>num</span><span class='comma'>,</span> <span class='id identifier rubyid_study_id'>study_id</span><span class='rparen'>)</span>
	<span class='ivar'>@other</span> <span class='op'>=</span> <span class='const'>SecondaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_study_id'>study_id</span><span class='comma'>,</span> <span class='symbol'>:display_number</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_num'>num</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
	<span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@other</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
		<span class='ivar'>@other</span><span class='period'>.</span><span class='id identifier rubyid_display_number'>display_number</span> <span class='op'>=</span> <span class='ivar'>@other</span><span class='period'>.</span><span class='id identifier rubyid_display_number'>display_number</span> <span class='op'>+</span> <span class='int'>1</span><span class='semicolon'>;</span>
		<span class='ivar'>@other</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_pub_uis-class_method">
  
    + (<tt>array</tt>) <strong>get_pub_uis</strong>(pub_id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
get secondary publication numbers based on the secondary publication id.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>pub_id</span>
      
      
        <span class='type'>(<tt>integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the secondary publication id
</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the list of secondary publication numbers
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/secondary_publication.rb', line 12</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_pub_uis'>get_pub_uis</span><span class='lparen'>(</span><span class='id identifier rubyid_pub_id'>pub_id</span><span class='rparen'>)</span>
	<span class='kw'>return</span> <span class='const'>SecondaryPublicationNumber</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:secondary_publication_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pub_id'>pub_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_summary_info_by_pmid-class_method">
  
    + (<tt>array</tt>) <strong>get_summary_info_by_pmid</strong>(pmid) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Given an pubmed ID, return author, title, year, etc.  by parsing XML from
pubmed
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>pmid</span>
      
      
        <span class='type'>(<tt>integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
pubmed id
</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
array of data containing
[title,authors,country,year,journal_title,volume,issue]
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/secondary_publication.rb', line 68</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_summary_info_by_pmid'>get_summary_info_by_pmid</span><span class='lparen'>(</span><span class='id identifier rubyid_pmid'>pmid</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_pmid'>pmid</span> <span class='op'>=</span> <span class='id identifier rubyid_pmid'>pmid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
	<span class='id identifier rubyid_pmid'>pmid</span><span class='period'>.</span><span class='id identifier rubyid_strip!'>strip!</span>
	
	<span class='comment'># pull the full record for this publication from PubMed at NCBI
</span>	<span class='id identifier rubyid_url'>url</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&amp;id=</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_pmid'>pmid</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&amp;mode=xml</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>------- GETTING SUMMARY INFO BY PMID --------\n\n</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The initial URL is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>begin</span>
		<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>getting the XML for that URL...</span><span class='tstring_end'>&quot;</span></span>		
		<span class='comment'># get the xml as a string
</span>		<span class='id identifier rubyid_xml'>xml</span> <span class='op'>=</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTP</span><span class='period'>.</span><span class='id identifier rubyid_get_response'>get_response</span><span class='lparen'>(</span><span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span>
		<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>XML was collected: and is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbrace'>}</span><span class='tstring_content'> characters long\n</span><span class='tstring_end'>&quot;</span></span>
		<span class='comment'># create an xml document with nokogiri
</span>		<span class='comment'># set it to ignore blank nodes
</span>		<span class='id identifier rubyid_xml'>xml</span> <span class='op'>=</span> <span class='const'>Nokogiri</span><span class='op'>::</span><span class='const'>XML</span><span class='lparen'>(</span><span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
			<span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_noblanks'>noblanks</span>
		<span class='kw'>end</span>
		
		<span class='comment'># set default values in case fields cannot be found.
</span>		<span class='id identifier rubyid_authors'>authors</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-- Not Found --</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not Found - Please check PubMed ID for accuracy.</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-- Not Found --</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_country'>country</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-- Not Found --</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_journal_title'>journal_title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-- Not Found --</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_volume'>volume</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-- Not Found --</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_issue'>issue</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-- Not Found --</span><span class='tstring_end'>&quot;</span></span>
		
		
		<span class='comment'># get the year
</span>		<span class='id identifier rubyid_year_entry'>year_entry</span> <span class='op'>=</span> <span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//Article//PubDate//Year</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>unless</span> <span class='id identifier rubyid_year_entry'>year_entry</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='id identifier rubyid_year_entry'>year_entry</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
		<span class='kw'>end</span>
		
		<span class='comment'># get the authors
</span>		<span class='id identifier rubyid_auth'>auth</span> <span class='op'>=</span> <span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//Article//AuthorList//Author</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='id identifier rubyid_auth_entries'>auth_entries</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
		<span class='kw'>unless</span> <span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_author'>author</span><span class='op'>|</span>
				<span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='id identifier rubyid_author'>author</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_author'>author</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
				<span class='id identifier rubyid_auth_entries'>auth_entries</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmp'>tmp</span>
			<span class='kw'>end</span>
			<span class='id identifier rubyid_authors'>authors</span> <span class='op'>=</span> <span class='id identifier rubyid_auth_entries'>auth_entries</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>end</span>

	  <span class='comment'># get the title
</span>	 	<span class='id identifier rubyid_title_entry'>title_entry</span> <span class='op'>=</span> <span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//Article//ArticleTitle</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	 	<span class='kw'>unless</span> <span class='id identifier rubyid_title_entry'>title_entry</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	 		<span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_title_entry'>title_entry</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
		<span class='kw'>end</span>
	 	
		<span class='comment'># get the journal title
</span>		<span class='id identifier rubyid_journal_titl'>journal_titl</span> <span class='op'>=</span> <span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//Article//Journal//Title</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>unless</span> <span class='id identifier rubyid_journal_titl'>journal_titl</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='id identifier rubyid_journal_title'>journal_title</span> <span class='op'>=</span> <span class='id identifier rubyid_journal_titl'>journal_titl</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
		<span class='kw'>end</span>
		
		<span class='comment'># get the volume and issue
</span>		<span class='id identifier rubyid_vol'>vol</span> <span class='op'>=</span> <span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//Article//Journal//JournalIssue//Volume</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>unless</span> <span class='id identifier rubyid_vol'>vol</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='id identifier rubyid_volume'>volume</span> <span class='op'>=</span> <span class='id identifier rubyid_vol'>vol</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
		<span class='kw'>end</span>
		
		<span class='id identifier rubyid_ish'>ish</span> <span class='op'>=</span> <span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//Article//Journal//JournalIssue//Issue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>unless</span> <span class='id identifier rubyid_ish'>ish</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='id identifier rubyid_issue'>issue</span> <span class='op'>=</span> <span class='id identifier rubyid_ish'>ish</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
		<span class='kw'>end</span>	
				
		<span class='comment'># get the affiliation
</span>	 	<span class='id identifier rubyid_country_entry'>country_entry</span> <span class='op'>=</span> <span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//Article//Affiliation</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	 	<span class='kw'>unless</span> <span class='id identifier rubyid_country_entry'>country_entry</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	 		<span class='id identifier rubyid_country'>country</span> <span class='op'>=</span> <span class='id identifier rubyid_country_entry'>country_entry</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
 		<span class='kw'>end</span>
 		
  <span class='kw'>rescue</span>
  	<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n\n-----ERROR------\nAn error has occured: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='rbrace'>}</span><span class='tstring_content'>\n\n\n</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: Could not retrieve file information.</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_authors'>authors</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_country'>country</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span>		
		<span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_journal_title'>journal_title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_volume'>volume</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_issue'>issue</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span>
	<span class='comment'># remove any braces from the title (I see these once in a while)
</span>	<span class='id identifier rubyid_title'>title</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[\[\]]</span><span class='regexp_end'>/</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='kw'>return</span> <span class='lbracket'>[</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span><span class='id identifier rubyid_authors'>authors</span><span class='comma'>,</span><span class='id identifier rubyid_country'>country</span><span class='comma'>,</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span><span class='id identifier rubyid_journal_title'>journal_title</span><span class='comma'>,</span><span class='id identifier rubyid_volume'>volume</span><span class='comma'>,</span><span class='id identifier rubyid_issue'>issue</span><span class='rbracket'>]</span>		
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="move_up_this-class_method">
  
    + (<tt>Object</tt>) <strong>move_up_this</strong>(id, study_id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
increment display number (ordering number) of a secondary publication based
on the secondary publication id
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
secondary publication id
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>study_id</span>
      
      
        <span class='type'>(<tt>integer</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44
45
46
47
48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/secondary_publication.rb', line 42</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_move_up_this'>move_up_this</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_study_id'>study_id</span><span class='rparen'>)</span>
	<span class='ivar'>@this</span> <span class='op'>=</span> <span class='const'>SecondaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
	<span class='kw'>if</span> <span class='ivar'>@this</span><span class='period'>.</span><span class='id identifier rubyid_display_number'>display_number</span> <span class='op'>&gt;</span> <span class='int'>1</span>
		<span class='id identifier rubyid_new_num'>new_num</span> <span class='op'>=</span> <span class='ivar'>@this</span><span class='period'>.</span><span class='id identifier rubyid_display_number'>display_number</span> <span class='op'>-</span> <span class='int'>1</span>
		<span class='const'>SecondaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_decrease_other'>decrease_other</span><span class='lparen'>(</span><span class='id identifier rubyid_new_num'>new_num</span><span class='comma'>,</span> <span class='id identifier rubyid_study_id'>study_id</span><span class='rparen'>)</span>
		<span class='ivar'>@this</span><span class='period'>.</span><span class='id identifier rubyid_display_number'>display_number</span> <span class='op'>=</span> <span class='id identifier rubyid_new_num'>new_num</span>
		<span class='ivar'>@this</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="get_display_number-instance_method">
  
    - (<tt>integer</tt>) <strong>get_display_number</strong>(study_id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
get the next consecutive display number (ordering number) of a secondary
publication based on the study id
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>study_id</span>
      
      
        <span class='type'>(<tt>integer</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the next number in the sequence
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/secondary_publication.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_display_number'>get_display_number</span><span class='lparen'>(</span><span class='id identifier rubyid_study_id'>study_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_max'>current_max</span> <span class='op'>=</span> <span class='const'>SecondaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_maximum'>maximum</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>display_number</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>study_id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_study_id'>study_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_current_max'>current_max</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
  	<span class='id identifier rubyid_current_max'>current_max</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>end</span>
	<span class='kw'>return</span> <span class='id identifier rubyid_current_max'>current_max</span> <span class='op'>+</span> <span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="shift_display_numbers-instance_method">
  
    - (<tt>Object</tt>) <strong>shift_display_numbers</strong>(study_id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
adjust the display numbers (ordering numbers) of a secondary publication
based on the study id
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>study_id</span>
      
      
        <span class='type'>(<tt>integer</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32
33
34
35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/secondary_publication.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shift_display_numbers'>shift_display_numbers</span><span class='lparen'>(</span><span class='id identifier rubyid_study_id'>study_id</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_myNum'>myNum</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_display_number'>display_number</span>
	<span class='id identifier rubyid_hi_pubs'>hi_pubs</span> <span class='op'>=</span> <span class='const'>SecondaryPublication</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>study_id = ? AND display_number &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_study_id'>study_id</span><span class='comma'>,</span> <span class='id identifier rubyid_myNum'>myNum</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_hi_pubs'>hi_pubs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_pub'>pub</span><span class='op'>|</span>
	  <span class='id identifier rubyid_tmpNum'>tmpNum</span> <span class='op'>=</span> <span class='id identifier rubyid_pub'>pub</span><span class='period'>.</span><span class='id identifier rubyid_display_number'>display_number</span>
	  <span class='id identifier rubyid_pub'>pub</span><span class='period'>.</span><span class='id identifier rubyid_display_number'>display_number</span> <span class='op'>=</span> <span class='id identifier rubyid_tmpNum'>tmpNum</span> <span class='op'>-</span> <span class='int'>1</span>
	  <span class='id identifier rubyid_pub'>pub</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span> 
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Wed Feb  1 16:26:50 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.4 (ruby-1.9.2).
</div>

  </body>
</html>
