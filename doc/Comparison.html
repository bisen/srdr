<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Comparison
  
    &mdash; Documentation by YARD 0.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (C)</a> &raquo; 
    
    
    <span class="title">Comparison</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Comparison
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">Comparison</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/models/comparison.rb</dd>
  
</dl>
<div class="clear"></div>



  


  

  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_new_measures-class_method" title="create_new_measures (class method)">+ (Object) <strong>create_new_measures</strong>(titles, descriptions, comparison_ids, within_or_between) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
create_new_measures using a list of title and descriptions for new
measures, create them for the given ocde.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_comparison_data-class_method" title="save_comparison_data (class method)">+ (Object) <strong>save_comparison_data</strong>(comparators, datapoints, comparison_measures) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
-----------------------------------------	
save_comparison_data when a user submits a comparison, create comparator
objects and save the datapoints.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_within_arm_comparison_data-class_method" title="save_within_arm_comparison_data (class method)">+ (Object) <strong>save_within_arm_comparison_data</strong>(datapoints, comparators) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
save_within_arm_comparison_data given a list of within arm comparisons and
within-arm comparators, save the data to the database.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_measures-class_method" title="update_measures (class method)">+ (Object) <strong>update_measures</strong>(measures, comparison_id, previous, measure_type = &quot;default&quot;) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><hr style="height: 10px"></hr><p>
update_measures given a list of measures saved and those saved previously,
update the measures for a given  comparison.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_measures_for_all-class_method" title="update_measures_for_all (class method)">+ (Object) <strong>update_measures_for_all</strong>(measures, ocid, efid, sid, comparison_type, measure_type = 'default', sgid) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
update_measures_for_all given a list of measures saved, update the measures
for all comparison objects for this outcome/study/extraction form.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assign_measures-instance_method" title="#assign_measures (instance method)">- (Object) <strong>assign_measures</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
-----------------------------------------	
assign_measures Anytime a new comparison is created, measures need to be
assigned to it.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_all_user_defined_measures-instance_method" title="#get_all_user_defined_measures (instance method)">- (Object) <strong>get_all_user_defined_measures</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
get an array of measures that are unique for the study based on their
title.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_user_defined_measures-instance_method" title="#get_user_defined_measures (instance method)">- (Object) <strong>get_user_defined_measures</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
get_user_defined_measures in the event that the user had to create their
own measures rather than use the defaults, get the measures.
</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="create_new_measures-class_method">
  
    + (<tt>Object</tt>) <strong>create_new_measures</strong>(titles, descriptions, comparison_ids, within_or_between) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
create_new_measures using a list of title and descriptions for new
measures, create them for the given ocde
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/comparison.rb', line 79</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_new_measures'>create_new_measures</span><span class='lparen'>(</span><span class='id identifier rubyid_titles'>titles</span><span class='comma'>,</span><span class='id identifier rubyid_descriptions'>descriptions</span><span class='comma'>,</span><span class='id identifier rubyid_comparison_ids'>comparison_ids</span><span class='comma'>,</span><span class='id identifier rubyid_within_or_between'>within_or_between</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_titles'>titles</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
		<span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_titles'>titles</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_description'>description</span> <span class='op'>=</span> <span class='id identifier rubyid_descriptions'>descriptions</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='int'>0</span>
		<span class='id identifier rubyid_comparison_ids'>comparison_ids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='op'>|</span>
			<span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:title</span><span class='op'>=&gt;</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> 
															 <span class='symbol'>:measure_type</span><span class='op'>=&gt;</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='symbol'>:comparison_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='rparen'>)</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="save_comparison_data-class_method">
  
    + (<tt>Object</tt>) <strong>save_comparison_data</strong>(comparators, datapoints, comparison_measures) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
-----------------------------------------	
save_comparison_data when a user submits a comparison, create comparator
objects and save the datapoints
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/comparison.rb', line 120</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save_comparison_data'>save_comparison_data</span><span class='lparen'>(</span><span class='id identifier rubyid_comparators'>comparators</span><span class='comma'>,</span> <span class='id identifier rubyid_datapoints'>datapoints</span><span class='comma'>,</span> <span class='id identifier rubyid_comparison_measures'>comparison_measures</span><span class='rparen'>)</span>
	<span class='comment'># get a list of comparison IDs for the table
</span>	<span class='id identifier rubyid_comparison_ids'>comparison_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_comparison_measures'>comparison_measures</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
	
	<span class='comment'># for each comparison submitted
</span>	<span class='id identifier rubyid_comparison_ids'>comparison_ids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c_id'>c_id</span><span class='op'>|</span>
		<span class='comment'>#print &quot;STARTING CID: #{c_id}\n\n&quot;
</span>		<span class='comment'># Find existing comparators so that we can determine if anything needs to be removed in the end
</span>		<span class='id identifier rubyid_previous_comparator_ids'>previous_comparator_ids</span> <span class='op'>=</span> <span class='const'>Comparator</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:comparison_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_c_id'>c_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span>
     <span class='comment'>#print &quot;Previous comparator list is #{previous_comparator_ids}\n\n&quot;
</span>		<span class='comment'># For each comparator
</span>		<span class='id identifier rubyid_my_comparator_ids'>my_comparator_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_datapoints'>datapoints</span><span class='lbracket'>[</span><span class='id identifier rubyid_c_id'>c_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
		<span class='kw'>unless</span> <span class='id identifier rubyid_my_comparator_ids'>my_comparator_ids</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='id identifier rubyid_iter'>iter</span> <span class='op'>=</span> <span class='int'>0</span>
			<span class='id identifier rubyid_my_comparator_ids'>my_comparator_ids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='op'>|</span>
				<span class='comment'>#print &quot;STARTING COMPARATOR: #{comp_id}\n&quot;
</span>				<span class='comment'># Get the comparator object that we will enter measure data for
</span>				<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_comparators'>comparators</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='lbracket'>[</span><span class='id identifier rubyid_iter'>iter</span><span class='rbracket'>]</span>
				<span class='id identifier rubyid_comparator_string'>comparator_string</span> <span class='op'>=</span> <span class='id identifier rubyid_comparators'>comparators</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='semicolon'>;</span>
				<span class='id identifier rubyid_col_comparator'>col_comparator</span> <span class='op'>=</span> <span class='kw'>nil</span>
				<span class='kw'>if</span> <span class='id identifier rubyid_comp_id'>comp_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&lt;</span> <span class='int'>0</span>
					<span class='comment'>#print &quot;CREATING A NEW ONE...\n&quot;
</span>					<span class='id identifier rubyid_col_comparator'>col_comparator</span> <span class='op'>=</span> <span class='const'>Comparator</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:comparison_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_c_id'>c_id</span><span class='comma'>,</span> <span class='symbol'>:comparator</span><span class='op'>=&gt;</span><span class='id identifier rubyid_comparator_string'>comparator_string</span><span class='rparen'>)</span>
				<span class='kw'>elsif</span> <span class='id identifier rubyid_comp_id'>comp_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&gt;</span> <span class='int'>0</span>
					<span class='comment'>#print &quot;USING EXISTING\n&quot;
</span>					<span class='id identifier rubyid_col_comparator'>col_comparator</span> <span class='op'>=</span> <span class='const'>Comparator</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='rparen'>)</span>
					<span class='comment'>#print &quot;removing #{comp_id} from the previous_comparator_ids list\n&quot;
</span>					<span class='id identifier rubyid_previous_comparator_ids'>previous_comparator_ids</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
					<span class='comment'>#print &quot;previous_comparator_ids is now #{previous_comparator_ids}\n&quot;
</span>					<span class='id identifier rubyid_col_comparator'>col_comparator</span><span class='period'>.</span><span class='id identifier rubyid_comparator'>comparator</span> <span class='op'>=</span> <span class='id identifier rubyid_comparator_string'>comparator_string</span>
					<span class='id identifier rubyid_col_comparator'>col_comparator</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
				<span class='kw'>end</span>
				<span class='comment'># Get the measures that we need to save data for
</span>				<span class='id identifier rubyid_comp_measures'>comp_measures</span> <span class='op'>=</span> <span class='id identifier rubyid_comparison_measures'>comparison_measures</span><span class='lbracket'>[</span><span class='id identifier rubyid_c_id'>c_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
			  <span class='kw'>unless</span> <span class='id identifier rubyid_comp_measures'>comp_measures</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			  	<span class='id identifier rubyid_comp_measures'>comp_measures</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m_id'>m_id</span><span class='op'>|</span>
			  		<span class='comment'>#print &quot;Adding value for measure: #{m_id}...&quot;
</span>			  		<span class='id identifier rubyid_new_value'>new_value</span> <span class='op'>=</span> <span class='id identifier rubyid_datapoints'>datapoints</span><span class='lbracket'>[</span><span class='id identifier rubyid_c_id'>c_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_m_id'>m_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span>
			  		<span class='comment'>#print &quot;value is #{datapoints}\n\n&quot;
</span>			  		<span class='comment'>#print &quot;value is #{datapoints[c_id]}\n\n&quot;
</span>			  		<span class='comment'>#print &quot;value is #{datapoints[c_id][comp_id]}\n\n&quot;
</span>			  		<span class='comment'>#	print &quot;value is #{datapoints[c_id][comp_id][m_id]}\n\n&quot;
</span>			  		<span class='comment'>#print &quot;value is #{new_value}\n\n&quot;
</span>			  		<span class='comment'># try to find an existing datapoint
</span>			  		<span class='id identifier rubyid_dp'>dp</span> <span class='op'>=</span> <span class='const'>ComparisonDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:comparison_measure_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m_id'>m_id</span><span class='comma'>,</span> <span class='symbol'>:comparator_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_col_comparator'>col_comparator</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
			  		<span class='kw'>if</span> <span class='id identifier rubyid_dp'>dp</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
			  			<span class='kw'>unless</span> <span class='id identifier rubyid_new_value'>new_value</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
			  				<span class='id identifier rubyid_dp'>dp</span> <span class='op'>=</span> <span class='const'>ComparisonDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:comparison_measure_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m_id'>m_id</span><span class='comma'>,</span> <span class='symbol'>:comparator_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_col_comparator'>col_comparator</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
			  																				<span class='symbol'>:value</span><span class='op'>=&gt;</span><span class='id identifier rubyid_new_value'>new_value</span> <span class='rparen'>)</span>
							<span class='kw'>end</span>
			  	    <span class='comment'>#print &quot;Had to create a new datapoint object.\n\n&quot;
</span>						<span class='kw'>else</span>
							<span class='id identifier rubyid_dp'>dp</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_new_value'>new_value</span>
							<span class='id identifier rubyid_dp'>dp</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
							<span class='comment'>#print &quot;Used a pre-existing object and saved the changes.\n\n&quot;
</span>						<span class='kw'>end</span> <span class='comment'># end if dp.nil?
</span>					<span class='kw'>end</span> <span class='comment'># end comp_measures.each do
</span>				<span class='kw'>end</span><span class='comment'># end unless comp_measures.empty?
</span>				<span class='id identifier rubyid_iter'>iter</span> <span class='op'>+=</span> <span class='int'>1</span>	
			<span class='kw'>end</span> <span class='comment'># end my_comparator_ids.each do
</span>		<span class='kw'>end</span> <span class='comment'># end unless my_comparator_ids.empty?
</span>		<span class='comment'># If there were any comparators previously in the table that were missing when it was saved,
</span>		<span class='comment'># then that means the column was deleted and so we'll delete that comparator.
</span>		<span class='comment'>#print &quot;NOW I'M GOING TO DELETE THE PRE-EXISTING, AND THERE ARE #{previous_comparator_ids.length} OF THEM\n\n&quot;
</span>	  <span class='kw'>unless</span> <span class='id identifier rubyid_previous_comparator_ids'>previous_comparator_ids</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>0</span>
	  	<span class='id identifier rubyid_previous_comparator_ids'>previous_comparator_ids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
	  		<span class='const'>Comparator</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	  	<span class='kw'>end</span>
	  <span class='kw'>end</span>
	<span class='kw'>end</span>	<span class='comment'># end comparison_ids.each do  		
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="save_within_arm_comparison_data-class_method">
  
    + (<tt>Object</tt>) <strong>save_within_arm_comparison_data</strong>(datapoints, comparators) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
save_within_arm_comparison_data given a list of within arm comparisons and
within-arm comparators, save the data to the database.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/comparison.rb', line 196</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save_within_arm_comparison_data'>save_within_arm_comparison_data</span> <span class='id identifier rubyid_datapoints'>datapoints</span><span class='comma'>,</span> <span class='id identifier rubyid_comparators'>comparators</span>
	<span class='comment'># get the comparison ids from the wac_datapoints hash
</span>	<span class='id identifier rubyid_comp_ids'>comp_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_datapoints'>datapoints</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
	<span class='id identifier rubyid_comp_ids'>comp_ids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='op'>|</span>
		<span class='comment'># ---------- FIRST TAKE CARE OF THE COMPARATOR ---------------#
</span>		<span class='comment'># get comparators previously saved for this comparison
</span>		<span class='id identifier rubyid_previous_comparator_ids'>previous_comparator_ids</span> <span class='op'>=</span> <span class='const'>Comparator</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:comparison_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span>
		
		<span class='comment'># now get the comparator id associated with this comparison
</span>		<span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span> <span class='op'>=</span> <span class='id identifier rubyid_comparators'>comparators</span><span class='lbracket'>[</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
		<span class='id identifier rubyid_new_comparator_id'>new_comparator_id</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_comparator_string'>comparator_string</span> <span class='op'>=</span> <span class='id identifier rubyid_comparators'>comparators</span><span class='lbracket'>[</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='comment'># if the comparator id is negative, create the new comparator
</span>		<span class='kw'>if</span> <span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span> <span class='op'>&lt;</span> <span class='int'>0</span>
			<span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='const'>Comparator</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:comparison_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='comma'>,</span> <span class='symbol'>:comparator</span><span class='op'>=&gt;</span><span class='id identifier rubyid_comparator_string'>comparator_string</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_new_comparator_id'>new_comparator_id</span> <span class='op'>=</span> <span class='id identifier rubyid_tmp'>tmp</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
		<span class='comment'># otherwise just assign the new_comparator_id = to the original and update the comparator
</span>		<span class='kw'>elsif</span> <span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span> <span class='op'>&gt;</span> <span class='int'>0</span>
			<span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='const'>Comparator</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_tmp'>tmp</span><span class='period'>.</span><span class='id identifier rubyid_comparator'>comparator</span> <span class='op'>=</span> <span class='id identifier rubyid_comparator_string'>comparator_string</span>
			<span class='id identifier rubyid_tmp'>tmp</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
			<span class='id identifier rubyid_new_comparator_id'>new_comparator_id</span> <span class='op'>=</span> <span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span>
			<span class='id identifier rubyid_previous_comparator_ids'>previous_comparator_ids</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_new_comparator_id'>new_comparator_id</span><span class='rparen'>)</span>
		<span class='kw'>end</span>
		<span class='comment'># ---------- NOW ADD THE DATA POINTS  ---------------#
</span>		<span class='comment'># get the measure ids associated with this comparator
</span>		<span class='id identifier rubyid_measures'>measures</span> <span class='op'>=</span> <span class='id identifier rubyid_datapoints'>datapoints</span><span class='lbracket'>[</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
		<span class='comment'># cycle through the measures 
</span>		<span class='id identifier rubyid_measures'>measures</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
			<span class='comment'># now cycle through the arm ids
</span>			<span class='id identifier rubyid_arms'>arms</span> <span class='op'>=</span> <span class='id identifier rubyid_datapoints'>datapoints</span><span class='lbracket'>[</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
			<span class='id identifier rubyid_arms'>arms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span>
				<span class='id identifier rubyid_dp_val'>dp_val</span> <span class='op'>=</span> <span class='id identifier rubyid_datapoints'>datapoints</span><span class='lbracket'>[</span><span class='id identifier rubyid_comp_id'>comp_id</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_a'>a</span><span class='rbracket'>]</span>
				<span class='id identifier rubyid_tmpDP'>tmpDP</span> <span class='op'>=</span> <span class='kw'>nil</span>
				<span class='kw'>if</span> <span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span> <span class='op'>&gt;</span> <span class='int'>0</span>
			  	<span class='comment'>#if the orig_comparator is greater than 0, determine if the datapoint already exists
</span>			  	<span class='id identifier rubyid_tmpDP'>tmpDP</span> <span class='op'>=</span> <span class='const'>ComparisonDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:comparison_measure_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='symbol'>:comparator_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_orig_comparator_id'>orig_comparator_id</span><span class='comma'>,</span> <span class='symbol'>:arm_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
			  	<span class='comment'># if it does, update it and save
</span>			  	<span class='kw'>unless</span> <span class='id identifier rubyid_tmpDP'>tmpDP</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
			  		<span class='id identifier rubyid_tmpDP'>tmpDP</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_dp_val'>dp_val</span>
			  		<span class='id identifier rubyid_tmpDP'>tmpDP</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
			  	<span class='comment'># otherwise, create it
</span>			  	<span class='kw'>else</span>
			  		<span class='id identifier rubyid_tmpDP'>tmpDP</span> <span class='op'>=</span> <span class='const'>ComparisonDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:comparison_measure_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='symbol'>:comparator_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_new_comparator_id'>new_comparator_id</span><span class='comma'>,</span> <span class='symbol'>:arm_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='symbol'>:value</span><span class='op'>=&gt;</span><span class='id identifier rubyid_dp_val'>dp_val</span><span class='rparen'>)</span>
			  	<span class='kw'>end</span>
			  <span class='kw'>else</span>
			  	<span class='comment'># if the comparator didn't exist then the datapoint didn't either, so create it
</span>			  	<span class='id identifier rubyid_tmpDP'>tmpDP</span> <span class='op'>=</span> <span class='const'>ComparisonDataPoint</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:comparison_measure_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='symbol'>:comparator_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_new_comparator_id'>new_comparator_id</span><span class='comma'>,</span> <span class='symbol'>:arm_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='symbol'>:value</span><span class='op'>=&gt;</span><span class='id identifier rubyid_dp_val'>dp_val</span><span class='rparen'>)</span>
			  <span class='kw'>end</span>	
			<span class='kw'>end</span> <span class='comment'># end arms.each do
</span>		<span class='kw'>end</span> <span class='comment'># end measures.each do 
</span>		
		<span class='comment'># finally, remove any comparators that are no longer being used
</span>		<span class='kw'>unless</span> <span class='id identifier rubyid_previous_comparator_ids'>previous_comparator_ids</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='id identifier rubyid_previous_comparator_ids'>previous_comparator_ids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pcid'>pcid</span><span class='op'>|</span>
				<span class='const'>Comparator</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='id identifier rubyid_pcid'>pcid</span><span class='rparen'>)</span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span> <span class='comment'># end comp_ids.each do
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update_measures-class_method">
  
    + (<tt>Object</tt>) <strong>update_measures</strong>(measures, comparison_id, previous, measure_type = &quot;default&quot;) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <hr style="height: 10px"></hr><p>
update_measures given a list of measures saved and those saved previously,
update the measures for a given  comparison
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/comparison.rb', line 261</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_measures'>update_measures</span><span class='lparen'>(</span><span class='id identifier rubyid_measures'>measures</span><span class='comma'>,</span><span class='id identifier rubyid_comparison_id'>comparison_id</span><span class='comma'>,</span><span class='id identifier rubyid_previous'>previous</span><span class='comma'>,</span><span class='id identifier rubyid_measure_type'>measure_type</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>default</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='comment'># keep track of previously saved information so we know what to delete
</span>	<span class='id identifier rubyid_previous'>previous</span> <span class='op'>=</span> <span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='kw'>unless</span> <span class='id identifier rubyid_measures'>measures</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='comment'># keys include the default measure id and study measure id separated by a '_'
</span>		<span class='id identifier rubyid_measures'>measures</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
			<span class='id identifier rubyid_keyParts'>keyParts</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
			<span class='id identifier rubyid_new_id'>new_id</span> <span class='op'>=</span> <span class='id identifier rubyid_keyParts'>keyParts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
			<span class='id identifier rubyid_prev_id'>prev_id</span> <span class='op'>=</span> <span class='id identifier rubyid_keyParts'>keyParts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
			<span class='kw'>if</span> <span class='id identifier rubyid_prev_id'>prev_id</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span>
				<span class='kw'>unless</span> <span class='id identifier rubyid_measure_type'>measure_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user-defined</span><span class='tstring_end'>&quot;</span></span>
					<span class='id identifier rubyid_measure'>measure</span> <span class='op'>=</span> <span class='const'>DefaultComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_new_id'>new_id</span><span class='rparen'>)</span>
				<span class='kw'>else</span>
					<span class='id identifier rubyid_measure'>measure</span> <span class='op'>=</span> <span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_new_id'>new_id</span><span class='rparen'>)</span>
				<span class='kw'>end</span>
				<span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:comparison_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_comparison_id'>comparison_id</span><span class='comma'>,</span> <span class='symbol'>:title</span><span class='op'>=&gt;</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span>
																 <span class='symbol'>:unit</span><span class='op'>=&gt;</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='symbol'>:measure_type</span><span class='op'>=&gt;</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_measure_type'>measure_type</span><span class='rparen'>)</span>
			<span class='kw'>else</span>
			  <span class='kw'>unless</span> <span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
					<span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_prev_id'>prev_id</span><span class='rparen'>)</span><span class='rparen'>)</span>
				<span class='kw'>end</span>
			<span class='kw'>end</span>	
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	<span class='comment'># Now remove any previous ones that weren't chosen this time.
</span>	<span class='comment'># Calling destroy will also remove associated data points due to the model assignments
</span>	<span class='kw'>unless</span> <span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prev'>prev</span><span class='op'>|</span>
		  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_prev'>prev</span><span class='rparen'>)</span>
		  <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>	
		<span class='kw'>end</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update_measures_for_all-class_method">
  
    + (<tt>Object</tt>) <strong>update_measures_for_all</strong>(measures, ocid, efid, sid, comparison_type, measure_type = 'default', sgid) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
update_measures_for_all given a list of measures saved, update the measures
for all comparison objects for this outcome/study/extraction form
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/comparison.rb', line 297</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_measures_for_all'>update_measures_for_all</span><span class='lparen'>(</span><span class='id identifier rubyid_measures'>measures</span><span class='comma'>,</span> <span class='id identifier rubyid_ocid'>ocid</span><span class='comma'>,</span> <span class='id identifier rubyid_efid'>efid</span><span class='comma'>,</span> <span class='id identifier rubyid_sid'>sid</span><span class='comma'>,</span> <span class='id identifier rubyid_comparison_type'>comparison_type</span><span class='comma'>,</span><span class='id identifier rubyid_measure_type'>measure_type</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>default</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='id identifier rubyid_sgid'>sgid</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_entries'>entries</span> <span class='op'>=</span> <span class='const'>Comparison</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:outcome_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_ocid'>ocid</span><span class='comma'>,</span> <span class='symbol'>:subgroup_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_sgid'>sgid</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_efid'>efid</span><span class='comma'>,</span> <span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_sid'>sid</span><span class='comma'>,</span> <span class='symbol'>:within_or_between</span><span class='op'>=&gt;</span><span class='id identifier rubyid_comparison_type'>comparison_type</span><span class='rparen'>)</span>
	<span class='kw'>unless</span> <span class='id identifier rubyid_measures'>measures</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='id identifier rubyid_entries'>entries</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>		
			<span class='id identifier rubyid_previous'>previous</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
			<span class='kw'>if</span> <span class='id identifier rubyid_measure_type'>measure_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user-defined</span><span class='tstring_end'>'</span></span> 
				<span class='id identifier rubyid_previous'>previous</span> <span class='op'>=</span> <span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span><span class='symbol'>:conditions</span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comparison_id = ? AND measure_type = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
			<span class='kw'>else</span>
				<span class='id identifier rubyid_previous'>previous</span> <span class='op'>=</span> <span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span><span class='symbol'>:conditions</span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comparison_id = ? AND measure_type &lt;&gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
			<span class='kw'>end</span>
			<span class='id identifier rubyid_previous_titles'>previous_titles</span> <span class='op'>=</span> <span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='rbrace'>}</span>
			<span class='id identifier rubyid_measures'>measures</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
				<span class='id identifier rubyid_meas_id'>meas_id</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
				<span class='kw'>if</span> <span class='id identifier rubyid_measure_type'>measure_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user-defined</span><span class='tstring_end'>'</span></span>
					<span class='id identifier rubyid_measure'>measure</span> <span class='op'>=</span> <span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_meas_id'>meas_id</span><span class='rparen'>)</span>
				<span class='kw'>else</span>
					<span class='id identifier rubyid_measure'>measure</span> <span class='op'>=</span> <span class='const'>DefaultComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_meas_id'>meas_id</span><span class='rparen'>)</span>
				<span class='kw'>end</span>
				<span class='kw'>if</span> <span class='id identifier rubyid_previous_titles'>previous_titles</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='rparen'>)</span>
					<span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='id identifier rubyid_previous_titles'>previous_titles</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='rparen'>)</span><span class='rparen'>)</span>
					<span class='id identifier rubyid_previous_titles'>previous_titles</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='id identifier rubyid_previous_titles'>previous_titles</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='rparen'>)</span><span class='rparen'>)</span>
				<span class='kw'>else</span>
					<span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:comparison_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:title</span><span class='op'>=&gt;</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='symbol'>:unit</span><span class='op'>=&gt;</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='symbol'>:measure_type</span><span class='op'>=&gt;</span><span class='id identifier rubyid_measure'>measure</span><span class='period'>.</span><span class='id identifier rubyid_measure_type'>measure_type</span><span class='rparen'>)</span>
				<span class='kw'>end</span>
			<span class='kw'>end</span>
			<span class='kw'>unless</span> <span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
				<span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
					<span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='semicolon'>;</span>
				<span class='kw'>end</span>
			<span class='kw'>end</span>	
		<span class='kw'>end</span>
	<span class='kw'>else</span>
		<span class='comment'># find all comparison measures for the entries and remove them
</span>		<span class='id identifier rubyid_entry_ids'>entry_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_entries'>entries</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span>
		<span class='comment'># only do this for user-defined methods. we won't allow users to delete all default measures from a comparison
</span>		<span class='kw'>if</span> <span class='id identifier rubyid_measure_type'>measure_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user-defined</span><span class='tstring_end'>'</span></span>
			<span class='id identifier rubyid_previous'>previous</span> <span class='op'>=</span> <span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span><span class='symbol'>:conditions</span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comparison_id in (?) AND measure_type = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_entry_ids'>entry_ids</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		
			<span class='id identifier rubyid_previous'>previous</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
				<span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='rparen'>)</span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="assign_measures-instance_method">
  
    - (<tt>Object</tt>) <strong>assign_measures</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
-----------------------------------------	
assign_measures Anytime a new comparison is created, measures need to be
assigned to it.  If there are no other comparisons defined for the same
outcome then the defaults will be used from the default_comparison_measures
table
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/comparison.rb', line 10</span>

<span class='kw'>def</span> <span class='id identifier rubyid_assign_measures'>assign_measures</span>
	<span class='id identifier rubyid_ocid'>ocid</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_outcome_id'>outcome_id</span>
	<span class='id identifier rubyid_outcome'>outcome</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ocid'>ocid</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_outcome_type'>outcome_type</span> <span class='op'>=</span> <span class='id identifier rubyid_outcome'>outcome</span><span class='period'>.</span><span class='id identifier rubyid_outcome_type'>outcome_type</span>
	<span class='id identifier rubyid_sid'>sid</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_study_id'>study_id</span>
	<span class='id identifier rubyid_efid'>efid</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span>
	<span class='id identifier rubyid_wORb'>wORb</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_within_or_between'>within_or_between</span>
	<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Assigning measures for outcome </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ocid'>ocid</span><span class='rbrace'>}</span><span class='tstring_content'> sid </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sid'>sid</span><span class='rbrace'>}</span><span class='tstring_content'> efid </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_efid'>efid</span><span class='rbrace'>}</span><span class='tstring_content'> and wORb </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wORb'>wORb</span><span class='rbrace'>}</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span>
	<span class='comment'># determine if there are other comparisons in this study that defined measures can be 
</span>	<span class='comment'># borrowed from
</span>	<span class='id identifier rubyid_comps'>comps</span> <span class='op'>=</span> <span class='const'>Comparison</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:outcome_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_ocid'>ocid</span><span class='comma'>,</span> <span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_sid'>sid</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_efid'>efid</span><span class='comma'>,</span> <span class='symbol'>:within_or_between</span><span class='op'>=&gt;</span><span class='id identifier rubyid_wORb'>wORb</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Searched for comparisons with the same credentials and found </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_comps'>comps</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbrace'>}</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span>
	<span class='comment'># a boolean to determine if previous comparisons are defined for this study and 
</span>	<span class='comment'># whether or not they contain measures
</span>	<span class='id identifier rubyid_no_measures'>no_measures</span> <span class='op'>=</span> <span class='kw'>true</span>
	
	<span class='comment'># if there are comparisons, create the duplicate measures
</span>	<span class='kw'>unless</span> <span class='id identifier rubyid_comps'>comps</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Searching comparisons...</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_comps'>comps</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_comp'>comp</span><span class='op'>|</span>
			<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>searching </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span>
			<span class='id identifier rubyid_measures'>measures</span> <span class='op'>=</span> <span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_comparison_measures'>comparison_measures</span>
			<span class='kw'>if</span> <span class='id identifier rubyid_measures'>measures</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
				<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>found some measures to use.</span><span class='tstring_end'>&quot;</span></span>
				<span class='id identifier rubyid_no_measures'>no_measures</span> <span class='op'>=</span> <span class='kw'>false</span>
				<span class='id identifier rubyid_measures'>measures</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
					<span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:comparison_id</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:title</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span><span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='symbol'>:unit</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span><span class='symbol'>:measure_type</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_measure_type'>measure_type</span><span class='rparen'>)</span>
				<span class='kw'>end</span>
				<span class='kw'>break</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_no_measures'>no_measures</span>
				<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>did not find any measures in comparison </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	<span class='comment'># if there are none within that outcome, check the study to see if there are any in other outcomes
</span>	<span class='comment'># that have measures. MAKE SURE TO ONLY USE OUTCOMES THAT ARE OF THE SAME TYPE
</span>	<span class='kw'>if</span> <span class='id identifier rubyid_no_measures'>no_measures</span>
		<span class='id identifier rubyid_outcome_ids'>outcome_ids</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_study_id'>study_id</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_extraction_form_id'>extraction_form_id</span><span class='comma'>,</span>
															  <span class='symbol'>:outcome_type</span><span class='op'>=&gt;</span><span class='id identifier rubyid_outcome_type'>outcome_type</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span>
		<span class='comment'># determine if there are other comparisons in this study that defined measures can be 
</span>		<span class='comment'># borrowed from
</span>		<span class='id identifier rubyid_comps'>comps</span> <span class='op'>=</span> <span class='const'>Comparison</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_sid'>sid</span><span class='comma'>,</span> <span class='symbol'>:extraction_form_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_efid'>efid</span><span class='comma'>,</span> <span class='symbol'>:outcome_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_outcome_ids'>outcome_ids</span><span class='comma'>,</span><span class='symbol'>:within_or_between</span><span class='op'>=&gt;</span><span class='id identifier rubyid_wORb'>wORb</span><span class='rparen'>)</span>

		<span class='comment'># if there are comparisons, create the duplicate measures
</span>		<span class='kw'>unless</span> <span class='id identifier rubyid_comps'>comps</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='id identifier rubyid_comps'>comps</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_comp'>comp</span><span class='op'>|</span>
				<span class='id identifier rubyid_measures'>measures</span> <span class='op'>=</span> <span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_comparison_measures'>comparison_measures</span>
				<span class='kw'>if</span> <span class='id identifier rubyid_measures'>measures</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
					<span class='id identifier rubyid_no_measures'>no_measures</span> <span class='op'>=</span> <span class='kw'>false</span>
					<span class='id identifier rubyid_measures'>measures</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
						<span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:comparison_id</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:title</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span><span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='symbol'>:unit</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span><span class='symbol'>:measure_type</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_measure_type'>measure_type</span><span class='rparen'>)</span>
					<span class='kw'>end</span>
					<span class='kw'>break</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_no_measures'>no_measures</span>
				<span class='kw'>end</span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	<span class='comment'># if there are still no comparisons containing measures, create new ones based on the defaults
</span>	<span class='kw'>if</span> <span class='id identifier rubyid_no_measures'>no_measures</span>	
		<span class='id identifier rubyid_oc'>oc</span> <span class='op'>=</span> <span class='const'>Outcome</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ocid'>ocid</span><span class='comma'>,</span> <span class='symbol'>:select</span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='symbol'>:outcome_type</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_w_or_b'>w_or_b</span> <span class='op'>=</span> <span class='id identifier rubyid_wORb'>wORb</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>within</span><span class='tstring_end'>'</span></span> <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='int'>1</span>
		<span class='id identifier rubyid_defaults'>defaults</span> <span class='op'>=</span> <span class='const'>DefaultComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:is_default</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:outcome_type</span><span class='op'>=&gt;</span><span class='id identifier rubyid_oc'>oc</span><span class='period'>.</span><span class='id identifier rubyid_outcome_type'>outcome_type</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='comma'>,</span> <span class='symbol'>:within_or_between</span><span class='op'>=&gt;</span><span class='id identifier rubyid_w_or_b'>w_or_b</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_defaults'>defaults</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span>
			<span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:comparison_id</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:title</span><span class='op'>=&gt;</span><span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span><span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='symbol'>:unit</span><span class='op'>=&gt;</span><span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span><span class='symbol'>:measure_type</span><span class='op'>=&gt;</span><span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_measure_type'>measure_type</span><span class='rparen'>)</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_all_user_defined_measures-instance_method">
  
    - (<tt>Object</tt>) <strong>get_all_user_defined_measures</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
get an array of measures that are unique for the study based on their title
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/comparison.rb', line 100</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_all_user_defined_measures'>get_all_user_defined_measures</span>
	<span class='comment'># get all comparison ids for the study
</span>	<span class='id identifier rubyid_comparisons'>comparisons</span> <span class='op'>=</span> <span class='const'>Comparison</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:study_id</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_study_id'>study_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span>
	<span class='comment'># get all associated user-defined measures
</span>	<span class='id identifier rubyid_measures'>measures</span> <span class='op'>=</span> <span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:comparison_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_comparisons'>comparisons</span><span class='comma'>,</span> <span class='symbol'>:measure_type</span><span class='op'>=&gt;</span><span class='int'>0</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_uniq_measures'>uniq_measures</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_title_array'>title_array</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_measures'>measures</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
		<span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_title_array'>title_array</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_uniq_measures'>uniq_measures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_m'>m</span>
			<span class='id identifier rubyid_title_array'>title_array</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	
	<span class='kw'>return</span> <span class='id identifier rubyid_uniq_measures'>uniq_measures</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_user_defined_measures-instance_method">
  
    - (<tt>Object</tt>) <strong>get_user_defined_measures</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
get_user_defined_measures in the event that the user had to create their
own measures rather than use the defaults, get the measures
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/comparison.rb', line 94</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_user_defined_measures'>get_user_defined_measures</span>
	<span class='id identifier rubyid_measures'>measures</span> <span class='op'>=</span> <span class='const'>ComparisonMeasure</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span><span class='symbol'>:conditions</span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comparison_id = ? AND measure_type = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='kw'>return</span> <span class='id identifier rubyid_measures'>measures</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Wed Feb  1 16:26:48 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.4 (ruby-1.9.2).
</div>

  </body>
</html>